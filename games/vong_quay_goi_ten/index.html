<html lang="vi"><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/content/location/location.js" id="eppiocemhmnlbhjplcgkofciiegomcon"></script><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/extend-native-history-api.js"></script><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/requests.js"></script><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vòng Quay May Mắn và Trắc Nghiệm</title>
    <!-- 1. Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script><script bis_use="true" type="text/javascript" charset="utf-8" data-bis-config="[&quot;facebook.com/&quot;,&quot;twitter.com/&quot;,&quot;youtube-nocookie.com/embed/&quot;,&quot;//vk.com/&quot;,&quot;//www.vk.com/&quot;,&quot;linkedin.com/&quot;,&quot;//www.linkedin.com/&quot;,&quot;//instagram.com/&quot;,&quot;//www.instagram.com/&quot;,&quot;//www.google.com/recaptcha/api2/&quot;,&quot;//hangouts.google.com/webchat/&quot;,&quot;//www.google.com/calendar/&quot;,&quot;//www.google.com/maps/embed&quot;,&quot;spotify.com/&quot;,&quot;soundcloud.com/&quot;,&quot;//player.vimeo.com/&quot;,&quot;//disqus.com/&quot;,&quot;//tgwidget.com/&quot;,&quot;//js.driftt.com/&quot;,&quot;friends2follow.com&quot;,&quot;/widget&quot;,&quot;login&quot;,&quot;//video.bigmir.net/&quot;,&quot;blogger.com&quot;,&quot;//smartlock.google.com/&quot;,&quot;//keep.google.com/&quot;,&quot;/web.tolstoycomments.com/&quot;,&quot;moz-extension://&quot;,&quot;chrome-extension://&quot;,&quot;/auth/&quot;,&quot;//analytics.google.com/&quot;,&quot;adclarity.com&quot;,&quot;paddle.com/checkout&quot;,&quot;hcaptcha.com&quot;,&quot;recaptcha.net&quot;,&quot;2captcha.com&quot;,&quot;accounts.google.com&quot;,&quot;www.google.com/shopping/customerreviews&quot;,&quot;buy.tinypass.com&quot;,&quot;gstatic.com&quot;,&quot;secureir.ebaystatic.com&quot;,&quot;docs.google.com&quot;,&quot;contacts.google.com&quot;,&quot;github.com&quot;,&quot;mail.google.com&quot;,&quot;chat.google.com&quot;,&quot;audio.xpleer.com&quot;,&quot;keepa.com&quot;,&quot;static.xx.fbcdn.net&quot;,&quot;sas.selleramp.com&quot;,&quot;1plus1.video&quot;,&quot;console.googletagservices.com&quot;,&quot;//lnkd.demdex.net/&quot;,&quot;//radar.cedexis.com/&quot;,&quot;//li.protechts.net/&quot;,&quot;challenges.cloudflare.com/&quot;,&quot;ogs.google.com&quot;]" src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/executors/traffic.js"></script>
    <!-- 2. Tải thư viện icon Lucide -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- BỔ SUNG: 3. Tải thư viện âm thanh Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <style>
        /* CSS tùy chỉnh cho font chữ và một số hiệu ứng */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        
        /* Ẩn các view và modal ban đầu */
        #quiz-page,
        #winner-modal,
        #question-modal,
        #json-generator-modal, /* BỔ SUNG modal mới */
        #help-modal {
            display: none;
        }

        /* Hiệu ứng cho modal */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        /* HIỆU ỨNG NÚT BẤM (ĐÃ SỬA LỖI CLICK TRIỆT ĐỂ) */
        .btn-press {
            transition: all 0.05s ease-in-out;
            border-bottom-width: 4px;
        }
        .btn-press:active {
            transform: translateY(2px); /* Dịch chuyển nút xuống 2px (chỉ transform) */
            border-bottom-width: 2px; /* Giảm viền dưới để tạo hiệu ứng lún */
            /* ĐÃ XÓA: margin-top: 2px; (Đây là dòng code gây lỗi) */
        }
        .btn-press:hover {
            transform: scale(1.02); /* Thêm hiệu ứng hover ấn tượng */
        }
        
        /* Nút Quay ấn tượng hơn */
        #spin-btn:not(:disabled) {
            animation: pulse-animation 2s infinite;
        }
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(29, 78, 216, 0.7); } /* blue-700 */
            70% { box-shadow: 0 0 0 10px rgba(29, 78, 216, 0); }
            100% { box-shadow: 0 0 0 0 rgba(29, 78, 216, 0); }
        }
        
        /* CSS cho vòng quay và tên học sinh */
        #wheel {
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        
        .student-name {
            position: absolute;
            transform-origin: 50% 50%; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-weight: 600;
            color: white;
            text-align: center;
            max-width: 40%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* CSS cho Bảng Xếp Hạng */
        #leaderboard-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        #leaderboard-list li:nth-child(odd) {
            background-color: #f9fafb; /* bg-gray-50 */
        }
        #leaderboard-list li:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        #leaderboard-list .rank-1 { font-weight: bold; color: #ef4444; } /* red-500 */
        #leaderboard-list .rank-2 { font-weight: bold; color: #f97316; } /* orange-500 */
        #leaderboard-list .rank-3 { font-weight: bold; color: #3b82f6; } /* blue-500 */
        
        /* CSS cho Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            pointer-events: none; /* Cho phép click xuyên qua */
        }
        
        /* BỔ SUNG: CSS cho Nút Hướng Dẫn nổi */
        #show-help-modal-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            animation: pulse-animation 3s infinite; /* Dùng chung hiệu ứng cho nổi bật */
        }
        
        /* BỔ SUNG: CSS cho nội dung Hướng dẫn */
        #help-modal-content h2 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* text-gray-800 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 0.75rem; /* mb-3 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #e5e7eb; /* border-gray-200 */
        }

        /* BỔ SUNG: CSS cho tiêu đề đẹp */
        .title-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: title-glow 3s ease-in-out infinite alternate;
        }
        @keyframes title-glow {
            from { filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.8)); }
        }

        /* BỔ SUNG: CSS cho footer */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-top: 2px solid #cbd5e1;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .footer-text {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }
        .footer-author {
            font-size: 1rem;
            font-weight: 700;
            color: #334155;
            margin-top: 0.25rem;
        }
        #help-modal-content h3 {
            font-size: 1.1rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #3b82f6; /* text-blue-600 */
            margin-top: 1rem; /* mt-4 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        #help-modal-content p, #help-modal-content li {
            font-size: 0.95rem; /* ~text-sm */
            color: #4b5563; /* text-gray-600 */
            line-height: 1.6;
            margin-bottom: 0.5rem; /* mb-2 */
        }
        #help-modal-content ul {
            list-style-type: disc;
            padding-left: 1.5rem; /* pl-6 */
        }
        #help-modal-content code {
            background-color: #e5e7eb; /* bg-gray-200 */
            color: #be123c; /* text-rose-700 */
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.-top-4{top:-1rem}.left-1\/2{left:50%}.right-3{right:0.75rem}.top-3{top:0.75rem}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.my-4{margin-top:1rem;margin-bottom:1rem}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-2{margin-left:0.5rem}.mr-2{margin-right:0.5rem}.mr-3{margin-right:0.75rem}.mt-2{margin-top:0.5rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-12{height:3rem}.h-16{height:4rem}.h-20{height:5rem}.h-24{height:6rem}.h-3{height:0.75rem}.h-4{height:1rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-96{height:24rem}.h-\[50vh\]{height:50vh}.h-\[70vh\]{height:70vh}.h-full{height:100%}.max-h-60{max-height:15rem}.max-h-64{max-height:16rem}.min-h-0{min-height:0px}.min-h-screen{min-height:100vh}.w-1\/2{width:50%}.w-12{width:3rem}.w-16{width:4rem}.w-20{width:5rem}.w-24{width:6rem}.w-3{width:0.75rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-96{width:24rem}.w-full{width:100%}.max-w-3xl{max-width:48rem}.max-w-lg{max-width:32rem}.max-w-sm{max-width:24rem}.flex-shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.list-decimal{list-style-type:decimal}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-4{gap:1rem}.space-x-1 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.25rem * var(--tw-space-x-reverse));margin-left:calc(0.25rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.75rem * var(--tw-space-x-reverse));margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-4{border-width:4px}.border-8{border-width:8px}.border-t{border-top-width:1px}.border-blue-700{--tw-border-opacity:1;border-color:rgb(29 78 216 / var(--tw-border-opacity, 1))}.border-blue-800{--tw-border-opacity:1;border-color:rgb(30 64 175 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55 / var(--tw-border-opacity, 1))}.border-green-700{--tw-border-opacity:1;border-color:rgb(21 128 61 / var(--tw-border-opacity, 1))}.border-indigo-700{--tw-border-opacity:1;border-color:rgb(67 56 202 / var(--tw-border-opacity, 1))}.border-orange-700{--tw-border-opacity:1;border-color:rgb(194 65 12 / var(--tw-border-opacity, 1))}.border-purple-700{--tw-border-opacity:1;border-color:rgb(126 34 206 / var(--tw-border-opacity, 1))}.border-red-700{--tw-border-opacity:1;border-color:rgb(185 28 28 / var(--tw-border-opacity, 1))}.border-teal-700{--tw-border-opacity:1;border-color:rgb(15 118 110 / var(--tw-border-opacity, 1))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-yellow-300{--tw-border-opacity:1;border-color:rgb(253 224 71 / var(--tw-border-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-indigo-500{--tw-bg-opacity:1;background-color:rgb(99 102 241 / var(--tw-bg-opacity, 1))}.bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity:1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-teal-500{--tw-bg-opacity:1;background-color:rgb(20 184 166 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-100{--tw-bg-opacity:1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.bg-yellow-300{--tw-bg-opacity:1;background-color:rgb(253 224 71 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.p-3{padding:0.75rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.p-1{padding:0.25rem}.p-2{padding:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pl-6{padding-left:1.5rem}.pr-2{padding-right:0.5rem}.pr-4{padding-right:1rem}.pt-2{padding-top:0.5rem}.pt-4{padding-top:1rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.tracking-wider{letter-spacing:0.05em}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:inset 0 2px 4px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600:hover{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-600:hover{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-600:hover{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-600:hover{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-teal-600:hover{--tw-bg-opacity:1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.hover\:text-gray-600:hover{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.hover\:text-red-700:hover{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.hover\:text-blue-700:hover{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:border-transparent:focus{border-color:transparent}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-50:disabled{opacity:0.5}@media (min-width: 768px){.md\:h-\[500px\]{height:500px}.md\:w-\[500px\]{width:500px}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:w-1\/2{width:50%}.lg\:w-1\/4{width:25%}.lg\:flex-row{flex-direction:row}.lg\:space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.lg\:space-y-0 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}.lg\:p-8{padding:2rem}}</style></head>
<body class="p-4 lg:p-8" __processed_1d45026b-1a2a-4d7c-bedd-bc7ed20e67b0__="true" bis_register="W3sibWFzdGVyIjp0cnVlLCJleHRlbnNpb25JZCI6ImVwcGlvY2VtaG1ubGJoanBsY2drb2ZjaWllZ29tY29uIiwiYWRibG9ja2VyU3RhdHVzIjp7IkRJU1BMQVkiOiJkaXNhYmxlZCIsIkZBQ0VCT09LIjoiZGlzYWJsZWQiLCJUV0lUVEVSIjoiZGlzYWJsZWQiLCJSRURESVQiOiJkaXNhYmxlZCIsIlBJTlRFUkVTVCI6ImRpc2FibGVkIiwiSU5TVEFHUkFNIjoiZGlzYWJsZWQiLCJUSUtUT0siOiJkaXNhYmxlZCIsIkxJTktFRElOIjoiZGlzYWJsZWQiLCJDT05GSUciOiJkaXNhYmxlZCJ9LCJ2ZXJzaW9uIjoiMi4wLjMzIiwic2NvcmUiOjIwMDMzfV0=">

    <!-- Canvas cho Confetti -->
    <canvas id="confetti-canvas" width="1482" height="710"></canvas>
    
    <!-- BỔ SUNG: Nút Hướng Dẫn Nổi -->
    <button id="show-help-modal-btn" class="btn-press w-16 h-16 flex items-center justify-center bg-blue-600 text-white rounded-full shadow-xl hover:bg-blue-700 transition border-blue-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="help-circle" class="lucide lucide-help-circle w-8 h-8"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg>
    </button>

    <!-- =========== View 1: Vòng Quay (Mặc định) =========== -->
    <div id="wheel-view" class="flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:space-x-4 min-h-screen pb-16" bis_skin_checked="1">

        <!-- Panel Trái: Danh Sách Lớp và Bảng Xếp Hạng -->
        <div class="w-full lg:w-1/4 bg-white p-4 rounded-lg shadow-lg flex flex-col space-y-3" bis_skin_checked="1">
            
            <!-- BỔ SUNG: Bộ đếm lượt truy cập -->
            <div class="p-3 bg-yellow-100 border-yellow-300 border rounded-lg text-center shadow-inner" bis_skin_checked="1">
                <p class="text-sm font-semibold text-yellow-800 mb-2">Thầy/cô đã dùng và tải công cụ:</p>
                <!-- hitwebcounter Code START --><center>
                <a href="https://www.hitwebcounter.com/" target="_blank">
                <img src="https://hitwebcounter.com/counter/counter.php?page=21455391&amp;style=0006&amp;nbdigits=5&amp;type=page&amp;initCount=451" title="Free Tools" alt="Free Tools" border="0" mdnkozlw5=""></a>
            </center></div>
            <!-- KẾT THÚC: Bộ đếm lượt truy cập -->

            <!-- Danh sách lớp -->
            <div bis_skin_checked="1">
                <div class="flex items-center space-x-2" bis_skin_checked="1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="users" class="lucide lucide-users text-blue-600"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg>
                    <h2 class="text-xl font-bold text-gray-800">Danh sách Lớp</h2>
                </div>
                <p class="text-sm text-gray-600 mt-2">
                    Dán danh sách học sinh vào đây (mỗi tên một dòng).
                </p>
                <textarea id="student-textarea" class="w-full h-48 border border-gray-300 rounded-md p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition mt-2" rows="10" placeholder="Nguyễn Văn A
Trần Thị B
Lê Văn C...">Phạm Thanh Tú
Trần Thuỳ Dương
Vũ Mai Phương
Bùi Hoàng Hải
Phạm Hải Yến
Nguyễn Gia Bảo
Trần Anh Quân
Nguyễn Minh Anh
Tần Gia Hân
Lê Hồng Long
Phạm Phú Hưng
Đào Gia Bảo
Nguyễn Hà Linh</textarea>
            </div>
            
            <hr class="border-gray-200">

            <!-- Bảng Xếp Hạng -->
            <div class="flex-grow flex flex-col min-h-0" bis_skin_checked="1">
                <div class="flex justify-between items-center mb-2" bis_skin_checked="1">
                    <div class="flex items-center space-x-2" bis_skin_checked="1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="bar-chart-3" class="lucide lucide-bar-chart-3 text-green-600"><path d="M3 3v16a2 2 0 0 0 2 2h16"></path><path d="M18 17V9"></path><path d="M13 17V5"></path><path d="M8 17v-3"></path></svg>
                        <h2 class="text-xl font-bold text-gray-800">Bảng Xếp Hạng</h2>
                    </div>
                    <button id="clear-leaderboard-btn" class="text-xs text-red-500 hover:text-red-700 font-medium flex items-center space-x-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash" class="lucide lucide-trash w-3 h-3"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        <span>Xóa BXH</span>
                    </button>
                </div>
                <div id="leaderboard-container" class="flex-grow max-h-64 overflow-y-auto pr-2" bis_skin_checked="1">
                    <ul id="leaderboard-list" class="text-sm text-gray-700 space-y-1"><li class="text-sm text-gray-500 italic text-center">Chưa có ai trả lời.</li></ul>
                </div>
            </div>
        </div>

        <!-- Panel Giữa: Vòng Quay -->
        <div class="w-full lg:w-1/2 flex flex-col items-center justify-center p-4" bis_skin_checked="1">
            <h1 class="text-4xl font-extrabold text-center mb-6 uppercase tracking-wider title-gradient">
                Vòng Quay May Mắn
            </h1>
            
            <div class="relative flex items-center justify-center" bis_skin_checked="1">
                <!-- Kim chỉ (Pointer) -->
                <div class="absolute -top-4 left-1/2 -translate-x-1/2 z-20" style="width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 30px solid #E74C3C; filter: drop-shadow(0px -2px 2px rgba(0,0,0,0.3))" bis_skin_checked="1"></div>

                <!-- Vòng quay -->
                <div id="wheel-container" class="relative w-96 h-96 md:w-[500px] md:h-[500px] rounded-full border-8 border-white shadow-2xl overflow-hidden" bis_skin_checked="1">
                    <div id="wheel" class="w-full h-full relative" style="background: conic-gradient(rgb(255, 107, 107) 0deg, rgb(255, 107, 107) 27.6923deg, rgb(255, 209, 102) 27.6923deg, rgb(255, 209, 102) 55.3846deg, rgb(6, 214, 160) 55.3846deg, rgb(6, 214, 160) 83.0769deg, rgb(17, 138, 178) 83.0769deg, rgb(17, 138, 178) 110.769deg, rgb(7, 59, 76) 110.769deg, rgb(7, 59, 76) 138.462deg, rgb(224, 122, 95) 138.462deg, rgb(224, 122, 95) 166.154deg, rgb(61, 64, 91) 166.154deg, rgb(61, 64, 91) 193.846deg, rgb(129, 178, 154) 193.846deg, rgb(129, 178, 154) 221.538deg, rgb(242, 204, 143) 221.538deg, rgb(242, 204, 143) 249.231deg, rgb(244, 241, 222) 249.231deg, rgb(244, 241, 222) 276.923deg, rgb(155, 93, 229) 276.923deg, rgb(155, 93, 229) 304.615deg, rgb(241, 91, 181) 304.615deg, rgb(241, 91, 181) 332.308deg, rgb(254, 228, 64) 332.308deg, rgb(254, 228, 64) 360deg);" bis_skin_checked="1"><div class="student-name" style="top: 16.017%; left: 58.376%; transform: translate(-50%, -50%) rotate(103.846deg); font-size: 13.8286px;" bis_skin_checked="1">Phạm Thanh Tú</div><div class="student-name" style="top: 23.8021%; left: 73.2093%; transform: translate(-50%, -50%) rotate(131.538deg); font-size: 13.8286px;" bis_skin_checked="1">Trần Thuỳ Dương</div><div class="student-name" style="top: 37.5888%; left: 82.7256%; transform: translate(-50%, -50%) rotate(159.231deg); font-size: 13.8286px;" bis_skin_checked="1">Vũ Mai Phương</div><div class="student-name" style="top: 54.2188%; left: 84.7448%; transform: translate(-50%, -50%) rotate(186.923deg); font-size: 13.8286px;" bis_skin_checked="1">Bùi Hoàng Hải</div><div class="student-name" style="top: 69.8823%; left: 78.8044%; transform: translate(-50%, -50%) rotate(214.615deg); font-size: 13.8286px;" bis_skin_checked="1">Phạm Hải Yến</div><div class="student-name" style="top: 80.991%; left: 66.2653%; transform: translate(-50%, -50%) rotate(242.308deg); font-size: 13.8286px;" bis_skin_checked="1">Nguyễn Gia Bảo</div><div class="student-name" style="top: 85%; left: 50%; transform: translate(-50%, -50%) rotate(270deg); font-size: 13.8286px;" bis_skin_checked="1">Trần Anh Quân</div><div class="student-name" style="top: 80.991%; left: 33.7347%; transform: translate(-50%, -50%) rotate(297.692deg); font-size: 13.8286px;" bis_skin_checked="1">Nguyễn Minh Anh</div><div class="student-name" style="top: 69.8823%; left: 21.1956%; transform: translate(-50%, -50%) rotate(325.385deg); font-size: 13.8286px;" bis_skin_checked="1">Tần Gia Hân</div><div class="student-name" style="top: 54.2188%; left: 15.2552%; transform: translate(-50%, -50%) rotate(353.077deg); font-size: 13.8286px;" bis_skin_checked="1">Lê Hồng Long</div><div class="student-name" style="top: 37.5888%; left: 17.2744%; transform: translate(-50%, -50%) rotate(380.769deg); font-size: 13.8286px;" bis_skin_checked="1">Phạm Phú Hưng</div><div class="student-name" style="top: 23.8021%; left: 26.7907%; transform: translate(-50%, -50%) rotate(408.462deg); font-size: 13.8286px;" bis_skin_checked="1">Đào Gia Bảo</div><div class="student-name" style="top: 16.017%; left: 41.624%; transform: translate(-50%, -50%) rotate(436.154deg); font-size: 13.8286px;" bis_skin_checked="1">Nguyễn Hà Linh</div></div>
                </div>
                
                <!-- Tâm vòng quay -->
                <div class="absolute w-12 h-12 bg-white rounded-full border-4 border-gray-300 shadow-inner z-10" bis_skin_checked="1"></div>
            </div>
            
            <!-- Trạng thái quay -->
            <div id="spin-status" class="mt-6 h-8 text-xl font-semibold text-blue-600 animate-pulse" bis_skin_checked="1">
                <!-- Trạng thái (ví dụ: Đang quay...) sẽ được JS chèn vào đây -->
            </div>
        </div>

        <!-- Panel Phải: Menu Điều Khiển -->
        <div class="w-full lg:w-1/4 bg-white p-4 rounded-lg shadow-lg space-y-4" bis_skin_checked="1">
            <!-- Tiêu đề MENU -->
            <div class="text-center text-3xl font-bold text-white p-3 rounded-lg" style="background: linear-gradient(135deg, #FF8C00, #FFA500); text-shadow: 2px 2px 4px rgba(0,0,0,0.2); border-bottom: 4px solid #CD6600" bis_skin_checked="1">
                MENU
            </div>
            
            <!-- Nút điều hướng -->
            <button id="go-to-quiz-btn" class="btn-press w-full flex items-center justify-center space-x-2 bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-600 transition border-green-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="gamepad-2" class="lucide lucide-gamepad-2"><line x1="6" x2="10" y1="11" y2="11"></line><line x1="8" x2="8" y1="9" y2="13"></line><line x1="15" x2="15.01" y1="12" y2="12"></line><line x1="18" x2="18.01" y1="10" y2="10"></line><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"></path></svg>
                <span>Tới Trò Chơi</span>
            </button>

            <!-- Nút Reset -->
            <button id="reset-btn" class="btn-press w-full flex items-center justify-center space-x-2 bg-red-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-red-600 transition border-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="rotate-ccw" class="lucide lucide-rotate-ccw"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                <span>Reset game</span>
            </button>

            <!-- Thông tin số lượng -->
            <div class="bg-gray-100 p-3 rounded-lg text-center" bis_skin_checked="1">
                <p class="text-sm font-semibold text-gray-700">
                    Số học sinh còn lại: 
                    <span id="student-count" class="text-lg font-bold text-blue-600 ml-2">13 / 13</span>
                </p>
            </div>

            <!-- Các tùy chọn -->
            <div class="space-y-3 pt-2" bis_skin_checked="1">
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200" bis_skin_checked="1">
                    <label for="no-repeat-checkbox" class="text-sm font-medium text-gray-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="smile" class="lucide lucide-smile w-4 h-4 mr-2 text-green-500"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" x2="9.01" y1="9" y2="9"></line><line x1="15" x2="15.01" y1="9" y2="9"></line></svg>
                        Gọi tên không lặp lại
                    </label>
                    <input id="no-repeat-checkbox" type="checkbox" class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked="">
                </div>

                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200" bis_skin_checked="1">
                    <label for="spin-duration-input" class="text-sm font-medium text-gray-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings" class="lucide lucide-settings w-4 h-4 mr-2 text-gray-500"><path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        Thời gian quay (s)
                    </label>
                    <input id="spin-duration-input" type="number" min="1" max="20" class="w-16 text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" value="6">
                </div>
            </div>

            <!-- Chế độ chơi -->
            <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 space-y-3" bis_skin_checked="1">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="list-checks" class="lucide lucide-list-checks w-4 h-4 mr-2 text-gray-500"><path d="M13 5h8"></path><path d="M13 12h8"></path><path d="M13 19h8"></path><path d="m3 17 2 2 4-4"></path><path d="m3 7 2 2 4-4"></path></svg>
                    Chế độ chơi
                </label>
                <div class="flex items-center space-x-4" bis_skin_checked="1">
                    <div class="flex items-center" bis_skin_checked="1">
                        <input id="mode-all" type="radio" name="game-mode" value="all" class="h-4 w-4 text-blue-600 border-gray-300" checked="">
                        <label for="mode-all" class="ml-2 block text-sm text-gray-700">Nhiều câu hỏi</label>
                    </div>
                    <div class="flex items-center" bis_skin_checked="1">
                        <input id="mode-one" type="radio" name="game-mode" value="one" class="h-4 w-4 text-blue-600 border-gray-300">
                        <label for="mode-one" class="ml-2 block text-sm text-gray-700">Một câu hỏi</label>
                    </div>
                </div>
            </div>
            
            <!-- Nút Quay chính -->
            <button id="spin-btn" class="btn-press w-full text-2xl font-bold py-4 px-4 rounded-lg shadow-xl text-white transition bg-blue-600 hover:bg-blue-700 border-blue-800 disabled:opacity-50 disabled:cursor-not-allowed">QUAY</button>
            


            <!-- NÂNG CẤP: Quản lý câu hỏi -->
            <hr class="my-4 border-gray-200">
            
            <div class="space-y-3" bis_skin_checked="1">
                 <h3 class="text-lg font-bold text-gray-800 text-center">Quản lý câu hỏi</h3>
                 <p id="question-count-info" class="text-sm text-center text-gray-600">Đang có 2 câu hỏi.</p>
                 
                 <!-- Danh sách câu hỏi -->
                 <div id="question-list-ui" class="max-h-60 overflow-y-auto space-y-2 pr-2" bis_skin_checked="1"><li class="flex justify-between items-center p-2 bg-gray-50 rounded border border-gray-200">
                        <span class="text-sm text-gray-700 truncate pr-2" title="Nguyễn Ái Quốc gửi bản 'Yêu sách của nhân dân An Nam' đến Hội nghị Véc-xai vào năm nào?">Nguyễn Ái Quốc gửi bản 'Yêu sách của nhân dân An Nam' đến Hội nghị Véc-xai vào năm nào?</span>
                        <div class="flex-shrink-0 space-x-2" bis_skin_checked="1">
                            <button class="edit-question-btn p-1 text-blue-500 hover:text-blue-700" data-id="1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="edit-2" class="lucide lucide-edit-2 w-4 h-4"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"></path></svg>
                            </button>
                            <button class="delete-question-btn p-1 text-red-500 hover:text-red-700" data-id="1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash-2" class="lucide lucide-trash-2 w-4 h-4"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    </li><li class="flex justify-between items-center p-2 bg-gray-50 rounded border border-gray-200">
                        <span class="text-sm text-gray-700 truncate pr-2" title="Đâu là thủ đô của nước Việt Nam?">Đâu là thủ đô của nước Việt Nam?</span>
                        <div class="flex-shrink-0 space-x-2" bis_skin_checked="1">
                            <button class="edit-question-btn p-1 text-blue-500 hover:text-blue-700" data-id="2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="edit-2" class="lucide lucide-edit-2 w-4 h-4"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"></path></svg>
                            </button>
                            <button class="delete-question-btn p-1 text-red-500 hover:text-red-700" data-id="2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash-2" class="lucide lucide-trash-2 w-4 h-4"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    </li></div>
                 
                 <!-- Nút thêm mới -->
                 <button id="add-new-question-btn" class="btn-press w-full flex items-center justify-center space-x-2 mt-2 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-700 transition border-gray-800">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus-circle" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"></circle><path d="M8 12h8"></path><path d="M12 8v8"></path></svg>
                     <span>Thêm Câu Hỏi Mới</span>
                 </button>
                 
                 <!-- BỔ SUNG: Nút Import/Export -->
                 <div class="grid grid-cols-2 gap-2 mt-2" bis_skin_checked="1">
                     <button id="import-questions-btn" class="btn-press w-full flex items-center justify-center space-x-2 bg-teal-500 text-white font-bold py-2 px-3 rounded-lg shadow-md hover:bg-teal-600 transition border-teal-700 text-sm">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="upload-cloud" class="lucide lucide-upload-cloud"><path d="M12 13v8"></path><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path><path d="m8 17 4-4 4 4"></path></svg>
                         <span>Import .json</span>
                     </button>
                     <button id="export-questions-btn" class="btn-press w-full flex items-center justify-center space-x-2 bg-orange-500 text-white font-bold py-2 px-3 rounded-lg shadow-md hover:bg-orange-600 transition border-orange-700 text-sm">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="download-cloud" class="lucide lucide-download-cloud"><path d="M12 13v8l-4-4"></path><path d="m12 21 4-4"></path><path d="M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284"></path></svg>
                         <span>Export .json</span>
                     </button>
                 </div>
                 <input type="file" id="import-file-input" accept=".json" class="hidden">
                 
                 <!-- BỔ SUNG: Nút Tạo Ngân Hàng Câu Hỏi -->
                 <button id="show-json-generator-btn" class="btn-press w-full flex items-center justify-center space-x-2 mt-2 bg-indigo-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-600 transition border-indigo-700 text-sm">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-json-2" class="lucide lucide-file-json-2"><path d="M14 22h4a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v6"></path><path d="M14 2v5a1 1 0 0 0 1 1h5"></path><path d="M5 14a1 1 0 0 0-1 1v2a1 1 0 0 1-1 1 1 1 0 0 1 1 1v2a1 1 0 0 0 1 1"></path><path d="M9 22a1 1 0 0 0 1-1v-2a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-2a1 1 0 0 0-1-1"></path></svg>
                     <span>Tạo NH Câu hỏi (từ Text)</span>
                 </button>
            </div>

        </div>
    </div>



    <!-- =========== View 2: Màn Hình Trắc Nghiệm =========== -->
    <div id="quiz-page" class="w-full max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-xl" bis_skin_checked="1">
        <!-- Nội dung Quiz sẽ được JS chèn vào đây -->
    </div>
    
    <!-- =========== Modal: Chúc Mừng =========== -->
    <div id="winner-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" bis_skin_checked="1">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center relative transform transition-all" bis_skin_checked="1">
            <button id="winner-modal-close-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
            </button>
            
            <!-- Icon chúc mừng -->
            <div class="w-24 h-24 bg-yellow-300 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg" bis_skin_checked="1">
                <i data-lucide="trophy" class="w-12 h-12 text-yellow-700"></i>
            </div>
            
            <h2 class="text-xl font-semibold text-gray-600">Xin chúc mừng!</h2>
            <p id="winner-name" class="text-4xl font-extrabold text-blue-600 my-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.1)">
                <!-- Tên người thắng -->
            </p>
            <p class="text-base text-gray-500 mb-8">
                đã được chọn!
            </p>

            <div class="flex flex-col space-y-3" bis_skin_checked="1">
                <button id="winner-modal-go-quiz-btn" class="btn-press w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-600 transition border-green-700">
                    Bắt đầu Trắc nghiệm
                </button>
                <button id="winner-modal-close-btn-2" class="w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition">
                    Đóng
                </button>
            </div>
        </div>
    </div>
    
    <!-- =========== Modal: Thêm/Sửa Câu Hỏi =========== -->
    <div id="question-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" bis_skin_checked="1">
        <form id="question-form" class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full space-y-4">
            <div class="flex justify-between items-center" bis_skin_checked="1">
                <h3 id="question-modal-title" class="text-xl font-bold text-gray-800">Thêm Câu Hỏi Mới</h3>
                <button id="question-modal-close-btn" type="button" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                </button>
            </div>
            
            <!-- Input ẩn để lưu ID khi sửa -->
            <input type="hidden" id="question-id-input">
            
            <div bis_skin_checked="1">
                <label for="question-text-input" class="block text-sm font-medium text-gray-700 mb-1">
                  Câu hỏi
                </label>
                <textarea id="question-text-input" rows="3" class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required=""></textarea>
            </div>
            
            <!-- 4 đáp án -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" bis_skin_checked="1">
                <div bis_skin_checked="1">
                    <label for="option-input-0" class="block text-sm font-medium text-gray-700 mb-1">Đáp án 1</label>
                    <input id="option-input-0" type="text" class="option-input w-full border-gray-300 rounded-md shadow-sm" required="">
                </div>
                <div bis_skin_checked="1">
                    <label for="option-input-1" class="block text-sm font-medium text-gray-700 mb-1">Đáp án 2</label>
                    <input id="option-input-1" type="text" class="option-input w-full border-gray-300 rounded-md shadow-sm" required="">
                </div>
                <div bis_skin_checked="1">
                    <label for="option-input-2" class="block text-sm font-medium text-gray-700 mb-1">Đáp án 3</label>
                    <input id="option-input-2" type="text" class="option-input w-full border-gray-300 rounded-md shadow-sm" required="">
                </div>
                <div bis_skin_checked="1">
                    <label for="option-input-3" class="block text-sm font-medium text-gray-700 mb-1">Đáp án 4</label>
                    <input id="option-input-3" type="text" class="option-input w-full border-gray-300 rounded-md shadow-sm" required="">
                </div>
            </div>
            
            <div bis_skin_checked="1">
                <label for="correct-answer-select" class="block text-sm font-medium text-gray-700 mb-1">
                  Đáp án đúng là
                </label>
                <select id="correct-answer-select" class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                  <option value="0">Đáp án 1</option>
                  <option value="1">Đáp án 2</option>
                  <option value="2">Đáp án 3</option>
                  <option value="3">Đáp án 4</option>
                </select>
            </div>
            
            <div class="flex justify-end space-x-3" bis_skin_checked="1">
                 <button id="question-modal-cancel-btn" type="button" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition">
                  Hủy
                </button>
                <button type="submit" class="btn-press bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition border-blue-800">
                  Lưu Câu Hỏi
                </button>
            </div>
        </form>
    </div>
    

    
    <!-- BỔ SUNG: Modal Tạo Ngân Hàng Câu Hỏi (JSON Generator) -->
    <div id="json-generator-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" bis_skin_checked="1">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-3xl w-full space-y-4" bis_skin_checked="1">
            <div class="flex justify-between items-center" bis_skin_checked="1">
                <h3 class="text-xl font-bold text-gray-800">Tạo Ngân Hàng Câu Hỏi từ Text</h3>
                <button id="json-generator-close-btn" type="button" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                </button>
            </div>
            
            <p class="text-sm text-gray-600">
                Dán câu hỏi theo định dạng mẫu. Hệ thống sẽ tự động tìm đáp án có chứa `( đáp án đúng)`.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[50vh]" bis_skin_checked="1">
                <!-- Vùng nhập Text -->
                <div class="flex flex-col" bis_skin_checked="1">
                    <label for="text-input-area" class="block text-sm font-medium text-gray-700 mb-1">
                      Nhập Text tại đây:
                    </label>
                    <textarea id="text-input-area" class="w-full h-full flex-grow border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-mono text-sm" placeholder="Câu 1: 1+2 =??
	A. 4
	B. 6
	C. 3 ( đáp án đúng)
	D. 5

Câu 2: 5+7 =??
	A. 4
	B. 12 ( đáp án đúng)
	C. 6
	D. 3"></textarea>
                </div>
                
                <!-- Vùng hiển thị JSON -->
                <div class="flex flex-col" bis_skin_checked="1">
                    <label for="json-output-area" class="block text-sm font-medium text-gray-700 mb-1">
                      Kết quả JSON:
                    </label>
                    <textarea id="json-output-area" class="w-full h-full flex-grow border-gray-300 rounded-md shadow-sm bg-gray-100 font-mono text-sm" readonly="" placeholder="Kết quả JSON sẽ hiện ở đây..."></textarea>
                </div>
            </div>
            
            <div class="flex justify-between items-center space-x-3" bis_skin_checked="1">
                 <button id="convert-to-json-btn" type="button" class="btn-press w-1/2 flex items-center justify-center space-x-2 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition border-blue-800">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-right-left" class="lucide lucide-arrow-right-left"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
                  <span>Chuyển sang JSON</span>
                </button>
                <button id="download-json-btn" type="button" class="btn-press w-1/2 flex items-center justify-center space-x-2 bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-600 transition border-green-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled="">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="download" class="lucide lucide-download"><path d="M12 15V3"></path><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><path d="m7 10 5 5 5-5"></path></svg>
                  <span>Tải file JSON</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- BỔ SUNG: Modal Hướng Dẫn Sử Dụng -->
    <div id="help-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4" bis_skin_checked="1">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-3xl w-full relative" bis_skin_checked="1">
            <div class="flex justify-between items-center mb-4" bis_skin_checked="1">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book-open" class="lucide lucide-book-open text-blue-600 mr-3"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg>
                    Hướng Dẫn Sử Dụng
                </h3>
                <button id="help-modal-close-btn" type="button" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                </button>
            </div>
            
            <!-- Nội dung hướng dẫn -->
            <div id="help-modal-content" class="h-[70vh] overflow-y-auto pr-4" bis_skin_checked="1">
                <h2>I. Cách sử dụng cơ bản</h2>
                <ul>
                    <li><b>Bước 1: Nhập Danh sách Lớp</b>
                        <p>Dán danh sách học sinh của Thầy vào ô "Danh sách Lớp" ở panel bên trái (mỗi tên một dòng).</p>
                    </li>
                    <li><b>Bước 2: Cài đặt</b>
                        <p>Ở panel bên phải, Thầy có thể chọn "Gọi tên không lặp lại" (để học sinh đã quay không bị quay lại) và "Thời gian quay".</p>
                    </li>
                     <li><b>Bước 3: Quay số</b>
                        <p>Bấm nút "QUAY" màu xanh to ở panel phải. Vòng quay sẽ chạy và tự động chọn ra một học sinh.</p>
                    </li>
                     <li><b>Bước 4: Bắt đầu Trắc nghiệm</b>
                        <p>Một cửa sổ "Xin chúc mừng" sẽ hiện ra. Thầy bấm "Bắt đầu Trắc nghiệm" để đưa học sinh đó vào phần trả lời câu hỏi.</p>
                    </li>
                    <li><b>Bước 5: Bảng Xếp Hạng</b>
                        <p>Sau khi học sinh trả lời xong, điểm và thời gian sẽ được tự động lưu vào "Bảng Xếp Hạng" ở panel trái.</p>
                    </li>
                </ul>

                <h2>II. Quản lý Ngân Hàng Câu Hỏi</h2>
                <p>Đây là phần quan trọng nhất. Thầy có 3 cách để thêm câu hỏi vào ứng dụng:</p>
                
                <h3>Cách 1: Thêm thủ công (Thêm từng câu)</h3>
                <ol class="list-decimal pl-6">
                    <li>Ở panel phải, bấm nút <code>Thêm Câu Hỏi Mới</code>.</li>
                    <li>Một cửa sổ sẽ hiện ra. Thầy nhập nội dung câu hỏi, 4 đáp án.</li>
                    <li>Chọn đáp án đúng ở mục "Đáp án đúng là".</li>
                    <li>Bấm <code>Lưu Câu Hỏi</code>.</li>
                    <li>Thầy có thể <b>Sửa</b> / <b>Xóa</b> câu hỏi ngay tại danh sách bên dưới.</li>
                </ol>
                
                <h3>Cách 2: Tạo file JSON từ Text (Khuyến khích)</h3>
                <p>Đây là cách tiện lợi nhất để Thầy soạn hàng loạt câu hỏi bên file Word/Text rồi đưa vào.</p>
                <ol class="list-decimal pl-6">
                    <li>Ở panel phải, bấm nút <code>Tạo NH Câu hỏi (từ Text)</code>.</li>
                    <li>Một cửa sổ sẽ hiện ra. Thầy dán nội dung đã soạn vào ô "Nhập Text tại đây".</li>
                    <li><b>Quan trọng:</b> Thầy phải soạn đúng định dạng mẫu. (Xem ví dụ bên dưới).</li>
                    <li>Bấm nút <code>Chuyển sang JSON</code>.</li>
                    <li>Nếu thành công, Thầy bấm <code>Tải file JSON</code> để lưu ngân hàng câu hỏi này về máy.</li>
                    <li>Sau đó Thầy dùng Cách 3 (bên dưới) để "Import" file vừa tải về vào ứng dụng.</li>
                </ol>
                <p><b>Ví dụ định dạng Text mẫu:</b></p>
                <pre class="bg-gray-100 p-3 rounded-md text-sm text-gray-700 overflow-x-auto">Câu 1: 1+2 =??
    A. 4
    B. 6
    C. 3 ( đáp án đúng)
    D. 5

Câu 2: 5+7 =??
    A. 4
    B. 12 ( đáp án đúng)
    C. 6
    D. 3</pre>

                <h3>Cách 3: Import file .json (Nạp ngân hàng câu hỏi)</h3>
                <p>Khi Thầy đã có sẵn file <code>.json</code> (từ Cách 2 hoặc từ người khác), Thầy dùng cách này để nạp vào:</p>
                <ol class="list-decimal pl-6">
                    <li>Ở panel phải, bấm nút <code>Import .json</code>.</li>
                    <li>Chọn file <code>.json</code> mà Thầy đã lưu trên máy.</li>
                    <li>Ứng dụng sẽ tự động nạp toàn bộ câu hỏi từ file đó.</li>
                </ol>
                
                <h3>Cách 4: Sao lưu và Di chuyển</h3>
                <ul>
                    <li><b>Export .json:</b> Bấm nút này để xuất (tải về) toàn bộ câu hỏi *hiện tại* ra file <code>.json</code>.</li>
                    <li><b>Tải về file HTML:</b> Bấm nút này để tải về *toàn bộ ứng dụng* (file .html). File này sẽ <b>lưu lại cả danh sách học sinh và các câu hỏi Thầy đã thêm</b>. Thầy có thể gửi file này cho đồng nghiệp để sử dụng.</li>
                </ul>

                <h2>III. Mời Thầy tham gia Nhóm</h2>
                <p>Hãy tham gia các nhóm Zalo của cộng đồng giáo viên để cùng chia sẻ tài nguyên và học tập:</p>
                <ul class="space-y-3">
                    <li>
                        <a href="https://zalo.me/g/tncmdq530" target="_blank" class="font-medium text-blue-600 hover:underline">
                            <b>Nhóm tạo Video từ SGK</b>
                        </a>
                    </li>
                    <li>
                        <a href="https://zalo.me/g/uditpr888" target="_blank" class="font-medium text-blue-600 hover:underline">
                            <b>Nhóm nhận học liệu, học tập</b>
                        </a>
                    </li>
                </ul>
            </div>
            
             <div class="flex justify-end pt-4 border-t border-gray-200" bis_skin_checked="1">
                 <button id="help-modal-close-btn-2" type="button" class="btn-press bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 transition border-blue-800">
                  Đã hiểu
                </button>
            </div>
        </div>
    </div>


    <!-- =========== Toàn bộ Logic JavaScript =========== -->
    <script>
        // Chờ cho toàn bộ nội dung HTML được tải xong
        document.addEventListener('DOMContentLoaded', () => {

            // --- 0. BỔ SUNG: KHỞI TẠO ÂM THANH ---
            let audioInitialized = false;
            let tickSynth, winnerSynth, correctSynth, wrongSynth;
            
            // Hàm khởi tạo âm thanh (chạy một lần duy nhất)
            function initializeAudio() {
                if (audioInitialized) return;
                // Chỉ khởi tạo nếu Tone.js đã tải
                if (typeof Tone === 'undefined') {
                    console.warn("Tone.js chưa tải xong, không thể khởi tạo âm thanh.");
                    return;
                }
                
                try {
                    Tone.start(); // Yêu cầu Tone.js khởi động
                    
                    // Âm thanh 'tích' của vòng quay
                    tickSynth = new Tone.MembraneSynth({
                        octaves: 10,
                        pitchDecay: 0.05,
                        envelope: { attack: 0.001, decay: 0.2, sustain: 0 }
                    }).toDestination();

                    // Âm thanh chiến thắng (fanfare)
                    winnerSynth = new Tone.PolySynth(Tone.Synth, {
                        envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.5 }
                    }).toDestination();

                    // Âm thanh trả lời đúng
                    correctSynth = new Tone.PolySynth(Tone.Synth, {
                         envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.2 }
                    }).toDestination();

                    // Âm thanh trả lời sai
                    wrongSynth = new Tone.PolySynth(Tone.FMSynth, {
                        harmonicity: 1.2,
                        modulationIndex: 10,
                        envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.3 }
                    }).toDestination();
                    
                    audioInitialized = true;
                } catch (e) {
                    console.error("Không thể khởi tạo âm thanh:", e);
                }
            }
            
            // Các hàm phát âm thanh
            function playTickSound(note = "C2", velocity = 1) {
                if (!audioInitialized) return;
                tickSynth.triggerAttack(note, Tone.now(), velocity);
            }
            
            function playWinnerSound() {
                if (!audioInitialized) return;
                const now = Tone.now();
                winnerSynth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n", now);
                winnerSynth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n", now + 0.3);
            }
            
            function playCorrectSound() {
                if (!audioInitialized) return;
                correctSynth.triggerAttackRelease(["C5", "E5", "G5"], "16n", Tone.now());
            }
            
            function playWrongSound() {
                if (!audioInitialized) return;
                wrongSynth.triggerAttackRelease(["C3", "D#3"], "4n", Tone.now());
            }
            
            let tickInterval = null; // Biến để điều khiển tiếng "tích"

            // --- 1. KHỞI TẠO STATE (TRẠNG THÁI) CỦA ỨNG DỤNG ---
            let masterStudentList = [];
            let availableStudents = [];
            
            // Dữ liệu mặc định
            let initialQuizData = [
              {
                id: 1,
                question: "Nguyễn Ái Quốc gửi bản 'Yêu sách của nhân dân An Nam' đến Hội nghị Véc-xai vào năm nào?",
                options: ["1917", "1918", "1919", "1920"],
                correctAnswer: "1919"
              },
              {
                id: 2,
                question: "Đâu là thủ đô của nước Việt Nam?",
                options: ["Hà Nội", "TP. Hồ Chí Minh", "Đà Nẵng", "Hải Phòng"],
                correctAnswer: "Hà Nội"
              }
            ];
            
            let quizData = []; // Sẽ được tải từ localStorage
            
            let rotation = 0;
            let isSpinning = false;
            let noRepeat = true;
            let spinDuration = 6;
            let selectedStudent = null;
            let currentView = 'wheel'; // 'wheel' | 'quiz'
            
            // State cho quiz
            let currentQuizQuestions = []; 
            let gameMode = 'all'; 
            let currentQuestionIndex = 0;
            let score = 0;
            let quizFinished = false;
            
            // State cho Bảng Xếp Hạng
            let leaderboardData = []; // Sẽ được tải từ localStorage
            let quizStartTime = 0; 

            // --- 2. LẤY CÁC THÀNH PHẦN DOM (ELEMENTS) ---
            const wheelView = document.getElementById('wheel-view');
            const quizPage = document.getElementById('quiz-page');
            const confettiCanvas = document.getElementById('confetti-canvas'); 
            
            // Panel Trái
            const studentTextarea = document.getElementById('student-textarea');
            const leaderboardList = document.getElementById('leaderboard-list');
            const clearLeaderboardBtn = document.getElementById('clear-leaderboard-btn');
            
            // Panel Giữa
            const wheelContainer = document.getElementById('wheel-container');
            const wheel = document.getElementById('wheel');
            const spinStatus = document.getElementById('spin-status');
            
            // Panel Phải
            const goToQuizBtn = document.getElementById('go-to-quiz-btn');
            const resetBtn = document.getElementById('reset-btn');
            const studentCountEl = document.getElementById('student-count');
            const noRepeatCheckbox = document.getElementById('no-repeat-checkbox');
            const spinDurationInput = document.getElementById('spin-duration-input');
            const spinBtn = document.getElementById('spin-btn');
            const downloadBtn = document.getElementById('download-btn');
            const gameModeRadios = document.querySelectorAll('input[name="game-mode"]'); 
            // Panel Phải - Quản lý câu hỏi
            const questionListUI = document.getElementById('question-list-ui');
            const addNewQuestionBtn = document.getElementById('add-new-question-btn');
            const questionCountInfo = document.getElementById('question-count-info');
            const importQuestionsBtn = document.getElementById('import-questions-btn'); 
            const exportQuestionsBtn = document.getElementById('export-questions-btn'); 
            const importFileInput = document.getElementById('import-file-input'); 
            const showJsonGeneratorBtn = document.getElementById('show-json-generator-btn');


            // Modal Chúc Mừng
            const winnerModal = document.getElementById('winner-modal');
            const winnerName = document.getElementById('winner-name');
            const winnerModalCloseBtn = document.getElementById('winner-modal-close-btn');
            const winnerModalCloseBtn2 = document.getElementById('winner-modal-close-btn-2');
            const winnerModalGoQuizBtn = document.getElementById('winner-modal-go-quiz-btn');
            
            // Modal Câu Hỏi
            const questionModal = document.getElementById('question-modal');
            const questionForm = document.getElementById('question-form');
            const questionModalTitle = document.getElementById('question-modal-title');
            const questionIdInput = document.getElementById('question-id-input');
            const questionTextInput = document.getElementById('question-text-input');
            const optionInputs = document.querySelectorAll('.option-input');
            const correctAnswerSelect = document.getElementById('correct-answer-select');
            const questionModalCloseBtn = document.getElementById('question-modal-close-btn');
            const questionModalCancelBtn = document.getElementById('question-modal-cancel-btn');
            
            // Modal Zalo đã bị xóa
            
            // BỔ SUNG: Modal JSON Generator
            const jsonGeneratorModal = document.getElementById('json-generator-modal');
            const jsonGeneratorCloseBtn = document.getElementById('json-generator-close-btn');
            const textInputArea = document.getElementById('text-input-area');
            const jsonOutputArea = document.getElementById('json-output-area');
            const convertToJsonBtn = document.getElementById('convert-to-json-btn');
            const downloadJsonBtn = document.getElementById('download-json-btn');
            
            // BỔ SUNG: Modal Hướng Dẫn
            const helpModal = document.getElementById('help-modal');
            const showHelpModalBtn = document.getElementById('show-help-modal-btn');
            const helpModalCloseBtn = document.getElementById('help-modal-close-btn');
            const helpModalCloseBtn2 = document.getElementById('help-modal-close-btn-2');


            // --- 3. CÁC HÀM TIỆN ÍCH (UTILITY FUNCTIONS) ---

            // Hàm hiển thị view (màn hình)
            function showView(viewName) {
                currentView = viewName;
                if (viewName === 'wheel') {
                    wheelView.style.display = 'flex';
                    quizPage.style.display = 'none';
                } else if (viewName === 'quiz') {
                    wheelView.style.display = 'none';
                    quizPage.style.display = 'block';
                    startQuiz(); // Bắt đầu quiz khi chuyển view
                }
            }

            // Hàm hiển thị/ẩn modal
            function showModal(modalElement) {
                modalElement.style.display = 'flex';
            }
            function hideModal(modalElement) {
                modalElement.style.display = 'none';
            }
            
            // Hàm vẽ lại vòng quay (tên và màu sắc)
            function renderWheel() {
                wheel.innerHTML = ''; // Xóa tên cũ
                if (availableStudents.length === 0) {
                    wheel.style.background = '#ddd';
                    return;
                }

                // Dải màu
                const colors = [
                    '#FF6B6B', '#FFD166', '#06D6A0', '#118AB2', '#073B4C',
                    '#E07A5F', '#3D405B', '#81B29A', '#F2CC8F', '#F4F1DE',
                    '#9B5DE5', '#F15BB5', '#FEE440', '#00BBF9', '#00F5D4'
                ];
                
                const segmentAngleDeg = 360 / availableStudents.length;
                const segmentAngleRad = (Math.PI * 2) / availableStudents.length;
                let gradientColors = [];

                availableStudents.forEach((student, index) => {
                    // 1. Tạo màu cho vòng quay
                    const color = colors[index % colors.length];
                    gradientColors.push(`${color} ${segmentAngleDeg * index}deg ${segmentAngleDeg * (index + 1)}deg`);
                    
                    // 2. Thêm tên học sinh
                    const nameEl = document.createElement('div');
                    nameEl.className = 'student-name';
                    nameEl.textContent = student;
                    
                    // Tính toán góc
                    const angleDeg = (segmentAngleDeg * index) + (segmentAngleDeg / 2);
                    const angleRad = (segmentAngleRad * index) + (segmentAngleRad / 2);
                    
                    // Bán kính 35% từ tâm
                    const x = Math.sin(angleRad) * 35 + 50; 
                    const y = -Math.cos(angleRad) * 35 + 50;
                    
                    nameEl.style.top = `${y}%`;
                    nameEl.style.left = `${x}%`;
                    nameEl.style.transform = `translate(-50%, -50%) rotate(${angleDeg + 90}deg)`;
                    
                    // Lấy kích thước của wheel-container
                    const wheelSize = wheelContainer.clientWidth;
                    const fontSize = Math.max(8, Math.min(14, wheelSize / 35)); // Điều chỉnh cỡ chữ
                    nameEl.style.fontSize = `${fontSize}px`;
                    
                    wheel.appendChild(nameEl);
                });

                wheel.style.background = `conic-gradient(${gradientColors.join(', ')})`;
            }

            // Hàm cập nhật danh sách học sinh
            function updateStudentLists() {
                const inputText = studentTextarea.value;
                masterStudentList = inputText.split('\n').filter(name => name.trim() !== '');
                
                availableStudents = [...masterStudentList]; 
                
                updateUI(); // Cập nhật giao diện (vẽ lại vòng quay, cập nhật số đếm)
            }


            // Hàm cập nhật giao diện (số đếm, nút bấm)
            function updateUI() {
                studentCountEl.textContent = `${availableStudents.length} / ${masterStudentList.length}`;
                spinBtn.disabled = isSpinning || availableStudents.length === 0;
                
                if (availableStudents.length === 0 && masterStudentList.length > 0) {
                    spinBtn.textContent = "Hết học sinh";
                } else if (availableStudents.length === 0 && masterStudentList.length === 0) {
                    spinBtn.textContent = "Nhập DS";
                    spinBtn.disabled = true;
                }
                else {
                    spinBtn.textContent = "QUAY";
                }
                
                renderWheel();
            }
            
            // Hàm vẽ Bảng Xếp Hạng
            function renderLeaderboard() {
                leaderboardList.innerHTML = ''; // Xóa cũ
                
                if (leaderboardData.length === 0) {
                    leaderboardList.innerHTML = `<li class="text-sm text-gray-500 italic text-center">Chưa có ai trả lời.</li>`;
                    return;
                }
                
                // Sắp xếp: 1. Điểm cao nhất, 2. Thời gian thấp nhất
                leaderboardData.sort((a, b) => {
                    if (a.score !== b.score) {
                        return b.score - a.score; // Điểm cao hơn xếp trước
                    }
                    return a.time - b.time; // Cùng điểm, thời gian nhanh hơn xếp trước
                });
                
                leaderboardData.forEach((entry, index) => {
                    const li = document.createElement('li');
                    
                    let rankClass = 'text-gray-600';
                    if (index === 0) rankClass = 'rank-1';
                    else if (index === 1) rankClass = 'rank-2';
                    else if (index === 2) rankClass = 'rank-3';

                    li.innerHTML = `
                        <span class="flex items-center">
                            <span class="font-bold w-6 text-left ${rankClass}">#${index + 1}</span>
                            <span class="font-medium truncate" title="${entry.name}">${entry.name}</span>
                        </span>
                        <span class="font-bold text-gray-800 ml-2 whitespace-nowrap">
                            ${entry.score}/${entry.totalQuestions}
                            <span class="font-normal text-gray-500 text-xs">(${entry.time.toFixed(2)}s)</span>
                        </span>
                    `;
                    leaderboardList.appendChild(li);
                });
            }
            
            // Hàm Xóa Bảng Xếp Hạng
            function handleClearLeaderboard() {
                leaderboardData = [];
                renderLeaderboard();
                saveDataToLocalStorage(); // BỔ SUNG: Lưu thay đổi
            }

            // --- 4. CÁC HÀM XỬ LÝ LOGIC CHÍNH ---
            
            // Xử lý quay
            function handleSpin() {
                if (isSpinning || availableStudents.length === 0) return;
                
                // Khởi tạo âm thanh (chỉ chạy 1 lần)
                initializeAudio();

                isSpinning = true;
                spinStatus.textContent = 'Đang quay...';
                spinBtn.disabled = true;
                studentTextarea.disabled = true; // Vô hiệu hóa khi đang quay
                
                // Bắt đầu phát âm thanh "tích"
                if (tickInterval) clearInterval(tickInterval);
                let tickSpeed = 150; // Tốc độ ban đầu
                tickInterval = setInterval(() => {
                    playTickSound("C2", 0.5 + Math.random() * 0.5);
                    // Tăng tốc độ "tích"
                    clearInterval(tickInterval);
                    tickSpeed = Math.max(50, tickSpeed * 0.95); // Nhanh dần
                    tickInterval = setInterval(() => playTickSound("C2", 0.5 + Math.random() * 0.5), tickSpeed);
                }, tickSpeed);
                

                const winnerIndex = Math.floor(Math.random() * availableStudents.length);
                selectedStudent = availableStudents[winnerIndex];

                const segmentAngle = 360 / availableStudents.length;
                const targetBaseAngle = 360 - (winnerIndex * segmentAngle);
                const randomOffset = (Math.random() - 0.5) * segmentAngle * 0.8;
                const extraSpins = 360 * 5;
                const currentRotation = rotation % 360;
                const finalRotation = Math.ceil(rotation / 360) * 360 + extraSpins + targetBaseAngle + randomOffset - currentRotation;
                
                rotation += finalRotation;
                
                wheel.style.transitionDuration = `${spinDuration}s`;
                wheel.style.transform = `rotate(${rotation}deg)`;

                // Tạo hiệu ứng "tích" chậm dần ở giây cuối
                setTimeout(() => {
                    clearInterval(tickInterval);
                    tickSpeed = 300; // Tốc độ chậm
                    tickInterval = setInterval(() => playTickSound("C2", 1), tickSpeed);
                }, (spinDuration - 1.5) * 1000); // 1.5 giây cuối

                // Dừng hẳn
                setTimeout(() => {
                    isSpinning = false;
                    studentTextarea.disabled = false; // Mở lại
                    spinStatus.textContent = '';
                    
                    // Dừng âm thanh "tích"
                    if (tickInterval) clearInterval(tickInterval);
                    
                    // Phát âm thanh chiến thắng
                    playWinnerSound();
                    
                    // Bắn pháo giấy
                    triggerConfetti();
                    
                    winnerName.textContent = selectedStudent;
                    showModal(winnerModal);

                    if (noRepeat) {
                        availableStudents.splice(winnerIndex, 1);
                    }
                    
                    rotation = rotation % 360; // Chuẩn hóa góc quay
                    updateUI();
                }, spinDuration * 1000 + 200);
            }

            // Xử lý Reset
            function handleReset() {
                if (isSpinning) return;
                availableStudents = [...masterStudentList];
                selectedStudent = null;
                rotation = 0; // Reset cả góc quay
                wheel.style.transitionDuration = '0s';
                wheel.style.transform = `rotate(${rotation}deg)`;
                updateUI();
            }

            // Xử lý Tải về
            function handleDownload() {
                try {
                    // CẬP NHẬT: Lưu trữ dữ liệu state (danh sách học sinh, câu hỏi, bxh)
                    // vào chính các element trước khi tải
                    studentTextarea.textContent = studentTextarea.value; // Đảm bảo value được lưu vào DOM
                    
                    // BỔ SUNG: Lưu dữ liệu từ localStorage vào thẻ script
                    // để file tải về chứa dữ liệu MỚI NHẤT
                    saveDataToLocalStorage(); 
                    const dataToSave = {
                        quizData: JSON.parse(localStorage.getItem('vongQuayQuizData') || '[]'),
                        leaderboardData: JSON.parse(localStorage.getItem('vongQuayLeaderboardData') || '[]')
                    };
                    
                    // Xóa thẻ cũ nếu có
                    const oldDataScript = document.getElementById('app-data-storage');
                    if (oldDataScript) oldDataScript.remove();
                    
                    const dataScript = document.createElement('script');
                    dataScript.id = 'app-data-storage';
                    dataScript.type = 'application/json';
                    dataScript.textContent = JSON.stringify(dataToSave);
                    document.body.appendChild(dataScript);
                    
                    
                    // Lấy toàn bộ nội dung HTML hiện tại
                    const htmlContent = document.documentElement.outerHTML;
                    // Tạo một Blob (đối tượng dữ liệu lớn)
                    const blob = new Blob([htmlContent], { type: 'text/html' });
                    
                    // Tạo một thẻ <a> tạm thời
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob); // Tạo URL cho Blob
                    a.download = 'VongQuayMayMan_Luu.html'; // Tên file tải về
                    
                    // Thêm vào tài liệu, nhấp và xóa đi
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    // Giải phóng URL
                    URL.revokeObjectURL(a.href);
                    
                    // Xóa thẻ script data sau khi đã tải
                    dataScript.remove();
                    
                } catch (e) {
                    console.error("Lỗi khi tải file:", e);
                }
            }
            
            // BỔ SUNG: Hàm Lưu/Tải Dữ liệu từ LocalStorage
            function saveDataToLocalStorage() {
                try {
                    localStorage.setItem('vongQuayQuizData', JSON.stringify(quizData));
                    localStorage.setItem('vongQuayLeaderboardData', JSON.stringify(leaderboardData));
                    localStorage.setItem('vongQuayStudentList', JSON.stringify(masterStudentList));
                    localStorage.setItem('vongQuaySettings', JSON.stringify({
                        noRepeat: noRepeat,
                        spinDuration: spinDuration,
                        gameMode: gameMode
                    }));
                } catch (e) {
                    console.error("Lỗi khi lưu vào localStorage:", e);
                }
            }
            
            // SỬA ĐỔI: Hàm Tải Dữ Liệu khi khởi động (Ưu tiên localStorage)
            function loadDataOnStart() {
                // 1. Thử tải từ LocalStorage trước (ưu tiên cao nhất)
                const localQuizData = localStorage.getItem('vongQuayQuizData');
                const localLeaderboardData = localStorage.getItem('vongQuayLeaderboardData');
                const localStudentList = localStorage.getItem('vongQuayStudentList');
                const localSettings = localStorage.getItem('vongQuaySettings');

                if (localQuizData) {
                    quizData = JSON.parse(localQuizData);
                } else {
                    // 2. Nếu không có, thử tải từ thẻ script (dữ liệu từ file đã download)
                    const dataScript = document.getElementById('app-data-storage');
                    if (dataScript) {
                        try {
                            const data = JSON.parse(dataScript.textContent);
                            if (data.quizData) {
                                quizData = data.quizData;
                            } else {
                                quizData = initialQuizData; // Dùng mặc định nếu thẻ có mà data rỗng
                            }
                        } catch (e) {
                             quizData = initialQuizData; // Dùng mặc định nếu lỗi parse
                        }
                    } else {
                         // 3. Nếu không có cả hai, dùng dữ liệu mặc định
                         quizData = initialQuizData;
                    }
                }

                // Tương tự cho Bảng Xếp Hạng
                if (localLeaderboardData) {
                    leaderboardData = JSON.parse(localLeaderboardData);
                } else {
                    const dataScript = document.getElementById('app-data-storage');
                    if (dataScript) {
                         try {
                             const data = JSON.parse(dataScript.textContent);
                             if (data.leaderboardData) {
                                 leaderboardData = data.leaderboardData;
                             }
                         } catch (e) { /* Bỏ qua, dùng mảng rỗng */ }
                    }
                }

                // Tải danh sách học sinh
                if (localStudentList) {
                    masterStudentList = JSON.parse(localStudentList);
                    studentTextarea.value = masterStudentList.join('\n');
                }

                // Tải cài đặt
                if (localSettings) {
                    const settings = JSON.parse(localSettings);
                    noRepeat = settings.noRepeat !== undefined ? settings.noRepeat : true;
                    spinDuration = settings.spinDuration !== undefined ? settings.spinDuration : 6;
                    gameMode = settings.gameMode !== undefined ? settings.gameMode : 'all';

                    // Cập nhật UI
                    noRepeatCheckbox.checked = noRepeat;
                    spinDurationInput.value = spinDuration;
                    gameModeRadios.forEach(radio => {
                        radio.checked = radio.value === gameMode;
                    });
                }

                // Sau khi tải xong, lưu lại vào localStorage để đồng bộ
                saveDataToLocalStorage();
            }
            
            // --- 5. LOGIC QUẢN LÝ CÂU HỎI (NÂNG CẤP) ---

            // Hàm hiển thị danh sách câu hỏi
            function renderQuestionList() {
                questionListUI.innerHTML = ''; // Xóa danh sách cũ
                
                if (quizData.length === 0) {
                    questionListUI.innerHTML = `<li class="text-sm text-gray-500 italic text-center">Chưa có câu hỏi nào.</li>`;
                }
                
                quizData.forEach(q => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center p-2 bg-gray-50 rounded border border-gray-200';
                    li.innerHTML = `
                        <span class="text-sm text-gray-700 truncate pr-2" title="${q.question}">${q.question}</span>
                        <div class="flex-shrink-0 space-x-2">
                            <button class="edit-question-btn p-1 text-blue-500 hover:text-blue-700" data-id="${q.id}">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button class="delete-question-btn p-1 text-red-500 hover:text-red-700" data-id="${q.id}">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                    questionListUI.appendChild(li);
                });
                
                // Cập nhật số lượng câu hỏi
                questionCountInfo.textContent = `Đang có ${quizData.length} câu hỏi.`;
                
                // Kích hoạt lại icon
                lucide.createIcons();
                
                // Gán sự kiện cho các nút Sửa/Xóa mới
                document.querySelectorAll('.edit-question-btn').forEach(btn => {
                    btn.onclick = (e) => handleEditQuestion(e.currentTarget.dataset.id);
                });
                document.querySelectorAll('.delete-question-btn').forEach(btn => {
                    btn.onclick = (e) => handleDeleteQuestion(e.currentTarget.dataset.id);
                });
            }
            
            // Hàm mở form để Thêm Mới
            function handleAddNewQuestion() {
                questionForm.reset(); // Xóa sạch form
                questionIdInput.value = ''; // Xóa ID (quan trọng)
                questionModalTitle.textContent = 'Thêm Câu Hỏi Mới';
                showModal(questionModal);
            }
            
            // Hàm mở form để Sửa
            function handleEditQuestion(id) {
                const question = quizData.find(q => q.id == id);
                if (!question) return;

                questionIdInput.value = question.id;
                questionTextInput.value = question.question;
                optionInputs.forEach((input, index) => {
                    input.value = question.options[index] || '';
                });
                
                const correctIndex = question.options.indexOf(question.correctAnswer);
                correctAnswerSelect.value = correctIndex >= 0 ? correctIndex : 0;
                
                questionModalTitle.textContent = 'Sửa Câu Hỏi';
                showModal(questionModal);
            }

            // Hàm Xóa câu hỏi
            function handleDeleteQuestion(id) {
                // Thầy có thể thêm một hộp thoại xác nhận ở đây
                // if (confirm('Thầy có chắc chắn muốn xóa câu hỏi này?')) { ... }
                
                quizData = quizData.filter(q => q.id != id);
                renderQuestionList();
                saveDataToLocalStorage(); // BỔ SUNG: Lưu thay đổi
            }
            
            // Hàm xử lý khi Submit Form (Thêm hoặc Sửa)
            function handleFormSubmit(e) {
                e.preventDefault();
                
                const id = questionIdInput.value;
                const options = Array.from(optionInputs).map(input => input.value.trim());
                const correctAnswerIndex = parseInt(correctAnswerSelect.value, 10);
                
                const questionPayload = {
                    question: questionTextInput.value.trim(),
                    options: options,
                    correctAnswer: options[correctAnswerIndex]
                };

                if (id) { // Sửa câu hỏi
                    const index = quizData.findIndex(q => q.id == id);
                    if (index !== -1) {
                        quizData[index] = { ...quizData[index], ...questionPayload };
                    }
                } else { // Thêm câu hỏi mới
                    questionPayload.id = Date.now(); // Tạo ID mới
                    quizData.push(questionPayload);
                }
                
                hideModal(questionModal);
                renderQuestionList();
                saveDataToLocalStorage(); // BỔ SUNG: Lưu thay đổi
            }
            
            // BỔ SUNG: Các hàm Import/Export
            function handleExportQuestions() {
                try {
                    const dataStr = JSON.stringify(quizData, null, 2); // Định dạng JSON cho đẹp
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'VongQuay_Questions.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(a.href);
                } catch (e) {
                    console.error("Lỗi khi export file:", e);
                }
            }
            
            function handleImportQuestions() {
                // Kích hoạt input file ẩn
                importFileInput.click();
            }
            
            function handleFileSelected(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        // Đơn giản là ghi đè
                        if (Array.isArray(importedData)) {
                            quizData = importedData;
                            renderQuestionList();
                            saveDataToLocalStorage(); // Lưu ngân hàng mới
                        } else {
                            console.error("File JSON không hợp lệ.");
                        }
                    } catch (err) {
                        console.error("Lỗi khi đọc file JSON:", err);
                    }
                };
                reader.readAsText(file);
                
                // Reset input để có thể chọn lại file cũ
                importFileInput.value = '';
            }
            
            // BỔ SUNG: Hàm xử lý cho JSON Generator
            
            // SỬA LỖI: Hàm phân tích text (Parser) đã được làm mạnh mẽ hơn
            function parseTextToJSON(rawText) {
                const questions = [];
                // Tách các câu hỏi bằng "Câu X:" (cho phép có khoảng trắng)
                const questionBlocks = rawText.split(/Câu\s*\d+:/).filter(b => b.trim() !== '');
                
                questionBlocks.forEach((block, index) => {
                    const lines = block.trim().split('\n').map(l => l.trim()).filter(l => l);
                    if (lines.length < 2) return; // Cần ít nhất 1 câu hỏi và 1 đáp án

                    const questionText = lines[0];
                    const options = [];
                    let correctAnswer = "";

                    // Regex để tìm đáp án:
                    // ^\s* : Bắt đầu bằng 0 hoặc nhiều khoảng trắng (tab)
                    // ([A-D])\.\s* : Bắt đầu bằng A. B. C. D. (cho phép khoảng trắng)
                    // (.*?) : Lấy nội dung đáp án (lười biếng)
                    // (\(\s*đáp án đúng\s*\))? : Nhóm tùy chọn (không bắt buộc) cho "( đáp án đúng )" (cho phép khoảng trắng)
                    // \s*$ : Kết thúc bằng 0 hoặc nhiều khoảng trắng
                    const optionRegex = /^\s*([A-D])\.\s*(.*?)(\(\s*đáp án đúng\s*\))?\s*$/i;

                    lines.slice(1).forEach(line => {
                        const match = line.match(optionRegex);
                        if (match) {
                            const optionText = match[2].trim(); // Lấy nội dung đáp án
                            options.push(optionText);
                            
                            const isCorrect = match[3] !== undefined; // Kiểm tra xem có cụm "( đáp án đúng)" không
                            if (isCorrect) {
                                correctAnswer = optionText;
                            }
                        }
                    });
                    
                    // Chỉ thêm nếu câu hỏi hợp lệ
                    if (questionText && options.length > 0 && correctAnswer) {
                        questions.push({
                            id: Date.now() + index,
                            question: questionText,
                            options: options,
                            correctAnswer: correctAnswer
                        });
                    }
                });
                
                return JSON.stringify(questions, null, 2); // Trả về chuỗi JSON được định dạng
            }
            
            // Xử lý bấm nút Chuyển đổi
            function handleConvertToJson() {
                const rawText = textInputArea.value;
                const jsonString = parseTextToJSON(rawText);
                jsonOutputArea.value = jsonString;
                
                // Cho phép tải về nếu có nội dung
                if (jsonString && jsonString !== "[]") {
                    downloadJsonBtn.disabled = false;
                } else {
                    downloadJsonBtn.disabled = true;
                }
            }
            
            // Xử lý bấm nút Tải JSON
            function handleDownloadJson() {
                const jsonText = jsonOutputArea.value;
                if (!jsonText || jsonText === "[]") return;
                
                 try {
                    const blob = new Blob([jsonText], { type: 'application/json' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'Generated_Questions.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(a.href);
                } catch (e) {
                    console.error("Lỗi khi export file JSON:", e);
                }
            }


            // --- 6. LOGIC TRẮC NGHIỆM (QUIZ) ---
            
            function startQuiz() {
                currentQuestionIndex = 0;
                score = 0;
                quizFinished = false;
                currentQuizQuestions = []; // Xóa câu hỏi của lượt trước
                
                if (!selectedStudent) {
                    renderQuizError("Chưa có học sinh!", "Vui lòng quay lại Vòng quay để chọn một học sinh.");
                    return;
                }
                
                if (quizData.length === 0) {
                     renderQuizError("Chưa có câu hỏi!", "Vui lòng quay lại và dùng form 'Quản lý câu hỏi' để thêm.");
                    return;
                }
                
                // Bắt đầu bấm giờ
                quizStartTime = Date.now();

                // Tích hợp logic chế độ chơi
                if (gameMode === 'one') {
                    // Chế độ 1 câu: Chọn ngẫu nhiên 1 câu
                    const randomIndex = Math.floor(Math.random() * quizData.length);
                    currentQuizQuestions.push(quizData[randomIndex]);
                } else {
                    // Chế độ nhiều câu: Lấy tất cả câu hỏi
                    currentQuizQuestions = [...quizData]; // Tạo bản sao
                }
                
                renderQuizQuestion();
            }
            
            function renderQuizError(title, message) {
                 quizPage.innerHTML = `
                    <div class="w-full h-full flex flex-col items-center justify-center text-center">
                        <i data-lucide="frown" class="w-24 h-24 text-red-500 mb-6"></i>
                        <h1 class="text-3xl font-bold text-gray-800">${title}</h1>
                        <p class="text-xl font-semibold text-red-600 mt-8">${message}</p>
                        <button id="back-to-wheel-btn-err" class="mt-12 bg-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-600 transition border-blue-700 btn-press">
                            <i data-lucide="chevron-left" class="inline-block mr-2"></i>
                            Quay Lại Vòng Quay
                        </button>
                    </div>
                 `;
                 lucide.createIcons();
                 document.getElementById('back-to-wheel-btn-err').onclick = () => showView('wheel');
            }
            
            function renderQuizQuestion() {
                if (quizFinished) {
                    renderQuizResult();
                    return;
                }
                
                const question = currentQuizQuestions[currentQuestionIndex];
                
                quizPage.innerHTML = `
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-lg font-semibold text-blue-600">
                            Học sinh: <span class="font-bold text-2xl">${selectedStudent}</span>
                        </p>
                        <p class="text-lg font-semibold text-gray-700">
                            Câu: <span class="font-bold text-2xl">${currentQuestionIndex + 1}</span> / ${currentQuizQuestions.length}
                        </p>
                    </div>

                    <h2 class="text-2xl font-bold text-gray-800 mb-8 min-h-[6rem]">
                        ${question.question}
                    </h2>

                    <div id="quiz-options-container" class="space-y-4 mb-8">
                        ${question.options.map((option, index) => `
                            <button
                                class="quiz-option-btn w-full text-left p-4 rounded-lg shadow-sm border transition duration-200 text-lg font-medium bg-white text-gray-700 hover:bg-gray-100 btn-press"
                                data-option="${option}"
                            >
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div id="quiz-feedback-container" class="min-h-[100px] mt-4">
                        <button
                            id="quiz-submit-btn"
                            class="w-full text-2xl font-bold py-4 px-4 rounded-lg shadow-xl text-white transition transform bg-blue-600 hover:bg-blue-700 border-blue-800 btn-press disabled:opacity-50"
                            disabled
                        >
                            Kiểm tra
                        </button>
                    </div>
                `;
                
                // Gán sự kiện cho các nút đáp án
                let selectedAnswer = null;
                const optionButtons = document.querySelectorAll('.quiz-option-btn');
                const submitBtn = document.getElementById('quiz-submit-btn');
                
                optionButtons.forEach(btn => {
                    btn.onclick = (e) => {
                        // Khởi tạo âm thanh (nếu chưa)
                        initializeAudio();
                        
                        // Bỏ chọn các nút khác
                        optionButtons.forEach(b => b.classList.remove('bg-blue-500', 'text-white', 'ring-2', 'ring-blue-700'));
                        // Chọn nút này
                        btn.classList.add('bg-blue-500', 'text-white', 'ring-2', 'ring-blue-700');
                        selectedAnswer = e.currentTarget.dataset.option;
                        submitBtn.disabled = false;
                    };
                });
                
                submitBtn.onclick = () => handleSubmitAnswer(selectedAnswer, question.correctAnswer);
            }
            
            function handleSubmitAnswer(selected, correct) {
                const isCorrect = (selected === correct);
                if (isCorrect) {
                    score++;
                    playCorrectSound(); // Phát âm thanh đúng
                } else {
                    playWrongSound(); // Phát âm thanh sai
                }
                
                // Hiển thị kết quả
                const feedbackContainer = document.getElementById('quiz-feedback-container');
                feedbackContainer.innerHTML = `
                    <div class="flex items-center p-4 rounded-lg mb-4 ${isCorrect ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                        <i data-lucide="${isCorrect ? 'check-circle' : 'x-circle'}" class="w-6 h-6 mr-3"></i>
                        <span class="text-lg font-semibold">
                            ${isCorrect ? "Chính xác!" : `Sai rồi! Đáp án đúng là: ${correct}`}
                        </span>
                    </div>
                    <button
                        id="quiz-next-btn"
                        class="w-full text-xl font-bold py-4 px-4 rounded-lg shadow-xl text-white transition transform bg-green-600 hover:bg-green-700 border-green-800 btn-press"
                    >
                        ${currentQuestionIndex === currentQuizQuestions.length - 1 ? 'Xem Kết Quả' : 'Câu Tiếp Theo'}
                    </button>
                `;
                lucide.createIcons();
                
                // Gán sự kiện cho nút "Tiếp theo"
                document.getElementById('quiz-next-btn').onclick = () => {
                    currentQuestionIndex++;
                    if (currentQuestionIndex >= currentQuizQuestions.length) {
                        quizFinished = true;
                    }
                    renderQuizQuestion(); // Vẽ câu tiếp theo hoặc kết quả
                };
                
                // Vô hiệu hóa các nút chọn
                document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                    btn.disabled = true;
                    const option = btn.dataset.option;
                    // Tô màu đúng/sai
                    if (option === correct) {
                        btn.className = 'quiz-option-btn w-full text-left p-4 rounded-lg shadow-sm border text-lg font-medium bg-green-500 text-white ring-2 ring-green-700';
                    } else if (option === selected && option !== correct) {
                         btn.className = 'quiz-option-btn w-full text-left p-4 rounded-lg shadow-sm border text-lg font-medium bg-red-500 text-white ring-2 ring-red-700';
                    } else {
                         btn.className = 'quiz-option-btn w-full text-left p-4 rounded-lg shadow-sm border text-lg font-medium bg-gray-200 text-gray-500';
                    }
                });
            }
            
            function renderQuizResult() {
                // Dừng bấm giờ và tính toán
                const quizEndTime = Date.now();
                const totalTimeInSeconds = (quizEndTime - quizStartTime) / 1000;
                
                // Lưu kết quả vào Bảng Xếp Hạng
                const resultEntry = {
                    name: selectedStudent,
                    score: score,
                    time: totalTimeInSeconds,
                    totalQuestions: currentQuizQuestions.length
                };
                leaderboardData.push(resultEntry);
                renderLeaderboard(); // Cập nhật BXH
                saveDataToLocalStorage(); // BỔ SUNG: Lưu BXH mới
                
                // Hiển thị kết quả (cập nhật để có thời gian)
                quizPage.innerHTML = `
                    <div class="w-full flex flex-col items-center justify-center text-center">
                        <i data-lucide="award" class="w-32 h-32 text-yellow-500 mb-6"></i>
                        <h1 class="text-3xl font-bold text-gray-800">Hoàn thành!</h1>
                        <p class="text-xl text-gray-600 mt-4">
                          Học sinh <span class="font-bold text-blue-600">${selectedStudent}</span>
                        </p>
                        <p class="text-2xl font-semibold text-gray-700 mt-2">
                          Đã đạt được:
                          <span class="text-4xl font-bold text-green-600 ml-3">
                            ${score} / ${currentQuizQuestions.length}
                          </span> điểm
                        </p>
                        <p class="text-xl text-gray-500 mt-2">
                            (trong ${totalTimeInSeconds.toFixed(2)} giây)
                        </p>
                        <button
                          id="back-to-wheel-btn-res"
                          class="mt-12 bg-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-600 transition border-blue-700 btn-press"
                        >
                          <i data-lucide="chevron-left" class="inline-block mr-2"></i>
                          Quay Lại Vòng Quay
                        </button>
                    </div>
                `;
                lucide.createIcons();
                document.getElementById('back-to-wheel-btn-res').onclick = () => showView('wheel');
            }
            
            // --- 7. BỔ SUNG: LOGIC HIỆU ỨNG PHÁO GIẤY (CONFETTI) ---
            const confettiCtx = confettiCanvas.getContext('2d');
            let confettiParticles = [];

            function triggerConfetti() {
                confettiParticles = []; // Xóa pháo giấy cũ
                const particleCount = 200; // Số lượng
                const colors = ['#FF6B6B', '#FFD166', '#06D6A0', '#118AB2', '#9B5DE5', '#F15BB5'];

                // Bắn từ 2 bên
                for (let i = 0; i < particleCount; i++) {
                    const fromLeft = Math.random() < 0.5;
                    confettiParticles.push({
                        x: fromLeft ? 0 : confettiCanvas.width, // Bắt đầu từ 2 cạnh
                        y: Math.random() * confettiCanvas.height, // Vị trí ngẫu nhiên
                        vx: (fromLeft ? 1 : -1) * (4 + Math.random() * 4), // Hướng vào
                        vy: -5 - Math.random() * 5, // Bắn lên
                        size: 5 + Math.random() * 5,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 120 // 120 khung hình (khoảng 2 giây)
                    });
                }
                
                // Bắt đầu vòng lặp vẽ
                if (!confettiAnimationRunning) {
                    animateConfetti();
                }
            }

            let confettiAnimationRunning = false;
            function animateConfetti() {
                confettiAnimationRunning = true;
                confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                
                confettiParticles.forEach((p, index) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.15; // Trọng lực
                    p.vx *= 0.99; // Giảm tốc
                    p.life--;
                    
                    if (p.life <= 0) {
                        confettiParticles.splice(index, 1);
                    } else {
                        confettiCtx.fillStyle = p.color;
                        confettiCtx.globalAlpha = p.life / 120;
                        confettiCtx.beginPath();
                        confettiCtx.rect(p.x, p.y, p.size, p.size);
                        confettiCtx.fill();
                        confettiCtx.globalAlpha = 1.0;
                    }
                });

                if (confettiParticles.length > 0) {
                    requestAnimationFrame(animateConfetti);
                } else {
                    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                    confettiAnimationRunning = false;
                }
            }

            // Hàm cập nhật kích thước canvas
            function resizeConfettiCanvas() {
                confettiCanvas.width = window.innerWidth;
                confettiCanvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeConfettiCanvas);
            resizeConfettiCanvas(); // Gọi lần đầu


            // --- 8. GÁN CÁC SỰ KIỆN BAN ĐẦU (EVENT LISTENERS) ---
            
            // Panel Trái
            studentTextarea.addEventListener('input', updateStudentLists);
            clearLeaderboardBtn.addEventListener('click', handleClearLeaderboard); 
            
            // Panel Phải
            spinBtn.addEventListener('click', handleSpin);
            resetBtn.addEventListener('click', handleReset);
            goToQuizBtn.addEventListener('click', () => showView('quiz'));
            
            noRepeatCheckbox.addEventListener('change', (e) => {
                noRepeat = e.target.checked;
                handleReset();
            });
            spinDurationInput.addEventListener('change', (e) => {
                spinDuration = parseInt(e.target.value, 10) || 6;
            });
            
            // Gán sự kiện cho các nút mới
            downloadBtn.addEventListener('click', handleDownload);
            gameModeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    gameMode = e.target.value;
                });
            });
            
            // BỔ SUNG: Gán sự kiện cho Import/Export
            importQuestionsBtn.addEventListener('click', handleImportQuestions);
            exportQuestionsBtn.addEventListener('click', handleExportQuestions);
            importFileInput.addEventListener('change', handleFileSelected);
            
            // BỔ SUNG: Gán sự kiện cho JSON Generator
            showJsonGeneratorBtn.addEventListener('click', () => showModal(jsonGeneratorModal));
            jsonGeneratorCloseBtn.addEventListener('click', () => hideModal(jsonGeneratorModal));
            convertToJsonBtn.addEventListener('click', handleConvertToJson);
            downloadJsonBtn.addEventListener('click', handleDownloadJson);

            // Modal Chúc Mừng
            winnerModalCloseBtn.addEventListener('click', () => hideModal(winnerModal));
            winnerModalCloseBtn2.addEventListener('click', () => hideModal(winnerModal));
            winnerModalGoQuizBtn.addEventListener('click', () => {
                hideModal(winnerModal);
                showView('quiz');
            });
            
            // Modal Câu Hỏi
            addNewQuestionBtn.addEventListener('click', handleAddNewQuestion);
            questionForm.addEventListener('submit', handleFormSubmit);
            questionModalCloseBtn.addEventListener('click', () => hideModal(questionModal));
            questionModalCancelBtn.addEventListener('click', () => hideModal(questionModal));
            
            
            // BỔ SUNG: Modal Hướng Dẫn
            showHelpModalBtn.addEventListener('click', () => showModal(helpModal));
            helpModalCloseBtn.addEventListener('click', () => hideModal(helpModal));
            helpModalCloseBtn2.addEventListener('click', () => hideModal(helpModal));

            // --- 9. KHỞI CHẠY ỨNG DỤNG ---
            loadDataOnStart(); // Tải dữ liệu (Ưu tiên localStorage)
            
            // Giữ lại danh sách mẫu nếu chưa có gì
            if (studentTextarea.value.trim() === '') {
                 studentTextarea.value = "Phạm Thanh Tú\nTrần Thuỳ Dương\nVũ Mai Phương\nBùi Hoàng Hải\nPhạm Hải Yến\nNguyễn Gia Bảo\nTrần Anh Quân\nNguyễn Minh Anh\nTần Gia Hân\nLê Hồng Long\nPhạm Phú Hưng\nĐào Gia Bảo\nNguyễn Hà Linh";
            }
            updateStudentLists(); // Tải danh sách học sinh lần đầu
            renderQuestionList(); // Tải danh sách câu hỏi lần đầu
            renderLeaderboard(); // Tải bảng xếp hạng lần đầu
            
            // Kích hoạt các icon lần đầu
            lucide.createIcons();
        });
    </script>

<script id="app-data-storage" type="application/json">{"quizData":[{"id":1,"question":"Nguyễn Ái Quốc gửi bản 'Yêu sách của nhân dân An Nam' đến Hội nghị Véc-xai vào năm nào?","options":["1917","1918","1919","1920"],"correctAnswer":"1919"},{"id":2,"question":"Đâu là thủ đô của nước Việt Nam?","options":["Hà Nội","TP. Hồ Chí Minh","Đà Nẵng","Hải Phòng"],"correctAnswer":"Hà Nội"}],"leaderboardData":[]}</script>

<!-- Câu đóng dấu ở cuối trang -->
<div class="text-center py-4 text-sm text-gray-500">
    © Ứng dụng được tạo bởi thầy Quân
</div>
</body></html>
