
<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B√© Th·ªè T√¨m Kho B√°u</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #FFE5B4 0%, #FFDAB9 50%, #FFB6C1 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        html {
            height: 100vh;
        }
        
        .game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-sizing: border-box;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 42px;
            font-weight: bold;
            color: #FF69B4;
            text-shadow: 3px 3px 0px #FFB6C1, 6px 6px 0px #FFC0CB;
            margin: 0 0 10px 0;
            animation: titleBounce 2s ease-in-out infinite;
        }
        
        @keyframes titleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .info-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: linear-gradient(135deg, #FFFFFF 0%, #FFF8DC 100%);
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 4px solid #FFD700;
        }
        
        .character-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #FF1493;
        }
        
        .game-body {
            display: flex;
            flex: 1;
            gap: 15px;
            overflow: hidden;
            padding-top: 15px;
        }

        .map-wrapper {
            flex: 3;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        .sparkle {
            position: absolute;
            font-size: 24px;
            animation: sparkleFloat 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes sparkleFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            50% { 
                transform: translateY(-20px) rotate(180deg);
                opacity: 1;
            }
        }
        
        .map-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255,215,0,0.5);
            border: 4px solid #FFD700;
            max-width: 100%;
            max-height: 100%;
            aspect-ratio: 12 / 10;
        }
        
        .tile {
            width: 100%;
            height: 100%;
            min-width: 0;
            min-height: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(16px, 4vw, 28px);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            border-radius: 6px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tile:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }
        
        .tile.grass {
            background: linear-gradient(135deg, #90EE90 0%, #98FB98 100%);
        }
        
        .tile.forest {
            background: linear-gradient(135deg, #7CFC00 0%, #32CD32 100%);
        }
        
        .tile.mountain {
            background: linear-gradient(135deg, #DEB887 0%, #D2B48C 100%);
        }
        
        .tile.water {
            background: linear-gradient(135deg, #87CEEB 0%, #87CEFA 100%);
            animation: waterShimmer 2s ease-in-out infinite;
        }
        
        @keyframes waterShimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .tile.castle {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 0 0 15px rgba(255,215,0,0.6);
        }
        
        .tile.path {
            background: linear-gradient(135deg, #F0E68C 0%, #EEE8AA 100%);
        }
        
        .tile.character {
            z-index: 10;
        }
        
        .character-sprite {
            font-size: clamp(24px, 5vw, 45px);
            animation: bunnyHop 0.6s ease-in-out infinite;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }
        
        @keyframes bunnyHop {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }
        
        .tile.selectable {
            box-shadow: 0 0 25px rgba(255, 215, 0, 1), inset 0 0 15px rgba(255, 255, 0, 0.5);
            animation: glowPulse 0.8s ease-in-out infinite;
            border: 3px solid #FFD700;
        }
        
        @keyframes glowPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 1);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 35px rgba(255, 255, 0, 1);
                transform: scale(1.05);
            }
        }
        
        .tile-icon {
            position: absolute;
            font-size: clamp(16px, 4vw, 28px);
        }
        
        .controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: linear-gradient(135deg, #FFFFFF 0%, #FFF8DC 100%);
            padding: 20px;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 4px solid #FFD700;
        }

        .controls-guide {
            text-align: center;
            font-size: 17px;
            color: #8B4513;
            font-weight: 600;
        }

        .controls-guide p {
            margin: 5px 0;
        }
        
        .control-btn {
            padding: 12px 25px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 4px solid #FF8C00;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255,140,0,0.4);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            width: 100%;
        }
        
        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(255,140,0,0.6);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        .challenge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .challenge-modal.active {
            display: flex;
        }
        
        .challenge-box {
            background: linear-gradient(135deg, #FFF8DC 0%, #FFFACD 100%);
            padding: 40px;
            border-radius: 30px;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            border: 6px solid #FFD700;
            animation: modalPop 0.3s ease;
        }
        
        @keyframes modalPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .challenge-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: iconSpin 1s ease;
        }
        
        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(0.5); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .challenge-title {
            font-size: 32px;
            font-weight: bold;
            color: #FF1493;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #FFB6C1;
        }
        
        .challenge-question {
            font-size: 24px;
            color: #8B4513;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 600;
        }
        
        .challenge-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .challenge-option {
            padding: 20px 25px;
            font-size: 20px;
            background: linear-gradient(135deg, #FFFFFF 0%, #F0F8FF 100%);
            border: 4px solid #87CEEB;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #4169E1;
        }
        
        .challenge-option:hover {
            background: linear-gradient(135deg, #E0FFFF 0%, #B0E0E6 100%);
            border-color: #4169E1;
            transform: scale(1.05);
        }
        
        .challenge-option.correct {
            background: linear-gradient(135deg, #90EE90 0%, #98FB98 100%);
            color: white;
            border-color: #32CD32;
            animation: correctPulse 0.5s ease;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .challenge-option.wrong {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFA07A 100%);
            color: white;
            border-color: #FF6347;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .challenge-feedback {
            font-size: 28px;
            font-weight: bold;
            margin-top: 20px;
            min-height: 40px;
        }
        
        .item-collected {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            padding: 35px 60px;
            border-radius: 25px;
            font-size: 32px;
            font-weight: bold;
            z-index: 3000;
            box-shadow: 0 15px 40px rgba(255,215,0,0.7);
            border: 5px solid #FF8C00;
            animation: itemPop 0.6s ease;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        @keyframes itemPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.3) rotate(10deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }
        
        .health-bar {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .heart {
            font-size: 28px;
            animation: heartBeat 1s ease-in-out infinite;
        }
        
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .inventory {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .inventory-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #FFE4E1 0%, #FFC0CB 100%);
            padding: 8px 18px;
            border-radius: 20px;
            border: 3px solid #FF69B4;
            font-weight: bold;
            color: #FF1493;
        }
        
        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #FF1493;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-container">
   <header class="header">
    <h1 class="game-title" id="gameTitle">üê∞ B√© Th·ªè T√¨m Kho B√°u üéÅ</h1>
    <div class="info-bar">
     <div class="character-info"><span style="font-size: 32px;">üê∞</span> <span id="characterName">Th·ªè Con</span>
     </div>
     <div class="health-bar"><span class="heart">üíñ</span> <span class="stats-number" id="healthDisplay">3/3</span>
     </div>
     <div class="inventory">
      <div class="inventory-item"><span style="font-size: 28px;">üéÅ</span> <span class="stats-number" id="treasureCount">0</span>/3
      </div>
      <div class="inventory-item"><span style="font-size: 28px;">ü•ï</span> <span class="stats-number" id="carrotCount">0</span>
      </div>
     </div>
     <div class="inventory-item"><span style="font-size: 24px;">üë£</span> <span class="stats-number" id="moveCount">0</span>
     </div>
    </div>
   </header>
   <div class="game-body">
    <main class="map-wrapper" id="mapWrapper">
     <div class="map-grid" id="mapGrid"></div>
    </main>
         <div class="controls">
          <div class="controls-guide">
           <p><strong>H∆∞·ªõng d·∫´n ch∆°i:</strong></p>
           <p>D√πng c√°c n√∫t ho·∫∑c ph√≠m m≈©i t√™n (‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è) ƒë·ªÉ di chuy·ªÉn Th·ªè.</p>
           <p>Thu th·∫≠p ƒë·ªß <strong>3 kho b√°u</strong> üéÅ ƒë·ªÉ th·∫Øng!</p>
          </div><button class="control-btn" onclick="moveCharacter('up')">‚¨ÜÔ∏è L√™n</button> <button class="control-btn" onclick="moveCharacter('down')">‚¨áÔ∏è Xu·ªëng</button> <button class="control-btn" onclick="moveCharacter('left')">‚¨ÖÔ∏è Tr√°i</button> <button class="control-btn" onclick="moveCharacter('right')">‚û°Ô∏è Ph·∫£i</button>
         </div>   </div>
  </div><!-- Challenge Modal -->
  <div class="challenge-modal" id="challengeModal">
   <div class="challenge-box">
    <div class="challenge-icon" id="challengeIcon">
     ü¶â
    </div>
    <h2 class="challenge-title" id="challengeTitle">Th·ª≠ th√°ch xu·∫•t hi·ªán!</h2>
    <p class="challenge-question" id="challengeQuestion"></p>
    <div class="challenge-options" id="challengeOptions"></div>
    <div class="challenge-feedback" id="challengeFeedback"></div>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            game_title: "üê∞ B√© Th·ªè T√¨m Kho B√°u üéÅ",
            character_name: "Th·ªè Con",
            encouragement_text: "Con l√†m t·ªët l·∫Øm!"
        };

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
                    document.getElementById('characterName').textContent = config.character_name || defaultConfig.character_name;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["game_title", config.game_title || defaultConfig.game_title],
                    ["character_name", config.character_name || defaultConfig.character_name],
                    ["encouragement_text", config.encouragement_text || defaultConfig.encouragement_text]
                ])
            });
        }

        // Game state
        let characterPos = { x: 1, y: 8 };
        let moveCount = 0;
        let health = 3;
        let treasures = 0;
        let carrots = 0;
        let currentChallenge = null;
        
        // Special items on map - challenges on walkable paths
        let mapItems = {
            challenges: [
                // Challenges on paths and grass areas
                { x: 2, y: 1, completed: false, type: 'math' },
                { x: 2, y: 2, completed: false, type: 'writing' },
                { x: 3, y: 2, completed: false, type: 'environment' },
                { x: 3, y: 4, completed: false, type: 'physical' },
                { x: 3, y: 5, completed: false, type: 'emotion' },
                { x: 4, y: 4, completed: false, type: 'math' },
                { x: 3, y: 7, completed: false, type: 'writing' },
                { x: 4, y: 7, completed: false, type: 'environment' },
                { x: 4, y: 8, completed: false, type: 'physical' },
                { x: 5, y: 8, completed: false, type: 'emotion' },
                { x: 6, y: 8, completed: false, type: 'math' },
                { x: 7, y: 8, completed: false, type: 'writing' },
                { x: 8, y: 8, completed: false, type: 'environment' },
                { x: 9, y: 8, completed: false, type: 'physical' },
                { x: 10, y: 8, completed: false, type: 'emotion' }
            ],
            treasures: [
                { x: 1, y: 1, collected: false, locked: true },
                { x: 11, y: 5, collected: false, locked: true },
                { x: 10, y: 6, collected: false, locked: true }
            ],
            carrots: [
                { x: 0, y: 3, collected: false },
                { x: 1, y: 4, collected: false },
                { x: 5, y: 5, collected: false },
                { x: 2, y: 7, collected: false },
                { x: 9, y: 7, collected: false },
                { x: 5, y: 9, collected: false }
            ]
        };
        
        // Map data
        const mapData = [
            ['forest', 'forest', 'forest', 'mountain', 'mountain', 'mountain', 'mountain', 'grass', 'grass', 'grass', 'grass', 'grass'],
            ['forest', 'castle', 'forest', 'mountain', 'mountain', 'grass', 'grass', 'grass', 'forest', 'forest', 'forest', 'grass'],
            ['forest', 'path', 'path', 'grass', 'grass', 'grass', 'water', 'water', 'forest', 'mountain', 'forest', 'grass'],
            ['grass', 'grass', 'path', 'grass', 'grass', 'water', 'water', 'water', 'grass', 'mountain', 'mountain', 'grass'],
            ['grass', 'grass', 'path', 'path', 'water', 'water', 'grass', 'grass', 'grass', 'grass', 'grass', 'grass'],
            ['grass', 'forest', 'forest', 'path', 'water', 'grass', 'grass', 'mountain', 'mountain', 'grass', 'grass', 'castle'],
            ['grass', 'forest', 'forest', 'path', 'path', 'grass', 'grass', 'mountain', 'grass', 'grass', 'path', 'path'],
            ['grass', 'grass', 'grass', 'grass', 'path', 'grass', 'grass', 'grass', 'grass', 'grass', 'path', 'forest'],
            ['grass', 'grass', 'grass', 'grass', 'path', 'path', 'path', 'path', 'path', 'path', 'path', 'forest'],
            ['water', 'water', 'water', 'grass', 'grass', 'forest', 'forest', 'forest', 'grass', 'grass', 'forest', 'forest']
        ];
        
        // Challenges for 5-6 year olds covering 5 developmental areas (5 questions each)
        const challenges = {
            // 1. To√°n h·ªçc & H√¨nh d·∫°ng (trong ph·∫°m vi 10)
            math: [
                {
                    question: "‚ûï 3 qu·∫£ t√°o + 2 qu·∫£ t√°o = ?",
                    options: ["4 qu·∫£", "5 qu·∫£", "6 qu·∫£", "7 qu·∫£"],
                    correct: 1
                },
                {
                    question: "‚ûñ 7 con b∆∞·ªõm - 3 con b∆∞·ªõm = ?",
                    options: ["3 con", "4 con", "5 con", "6 con"],
                    correct: 1
                },
                {
                    question: "üî∫ H√¨nh tam gi√°c c√≥ m·∫•y c·∫°nh?",
                    options: ["2 c·∫°nh", "3 c·∫°nh", "4 c·∫°nh", "5 c·∫°nh"],
                    correct: 1
                },
                {
                    question: "‚¨õ H√¨nh vu√¥ng c√≥ m·∫•y g√≥c?",
                    options: ["2 g√≥c", "3 g√≥c", "4 g√≥c", "5 g√≥c"],
                    correct: 2
                },
                {
                    question: "üî¢ ƒê·∫øm: üåüüåüüåüüåü c√≥ bao nhi√™u ng√¥i sao?",
                    options: ["3 ng√¥i", "4 ng√¥i", "5 ng√¥i", "6 ng√¥i"],
                    correct: 1
                }
            ],
            // 2. Ch·ªØ vi·∫øt - T√¨m ch·ªØ trong t·ª´
            writing: [
                {
                    question: "üÖ∞Ô∏è T·ª´ 'ƒÇn' b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ g√¨?",
                    options: ["Ch·ªØ ƒÇ", "Ch·ªØ E", "Ch·ªØ I", "Ch·ªØ O"],
                    correct: 0
                },
                {
                    question: "üêù T·ª´ 'Ong' c√≥ ch·ªØ g√¨ cu·ªëi c√πng?",
                    options: ["Ch·ªØ O", "Ch·ªØ N", "Ch·ªØ G", "Ch·ªØ B"],
                    correct: 2
                },
                {
                    question: "‚úèÔ∏è 'M_' c√≤n thi·∫øu ch·ªØ g√¨ ƒë·ªÉ th√†nh 'M·∫π'?",
                    options: ["Ch·ªØ A", "Ch·ªØ ·∫∏", "Ch·ªØ I", "Ch·ªØ O"],
                    correct: 1
                },
                {
                    question: "üå∏ T·ª´ 'Hoa' c√≥ bao nhi√™u ch·ªØ?",
                    options: ["1 ch·ªØ", "2 ch·ªØ", "3 ch·ªØ", "4 ch·ªØ"],
                    correct: 2
                },
                {
                    question: "üìö 'B_' c√≤n thi·∫øu ch·ªØ g√¨ ƒë·ªÉ th√†nh 'B√†'?",
                    options: ["Ch·ªØ ƒÇ", "Ch·ªØ √Ä", "Ch·ªØ E", "Ch·ªØ I"],
                    correct: 1
                }
            ],
            // 3. M√¥i tr∆∞·ªùng - B·∫£o v·ªá m√¥i tr∆∞·ªùng
            environment: [
                {
                    question: "üóëÔ∏è R√°c th·∫£i n√™n b·ªè v√†o ƒë√¢u?",
                    options: ["S√¥ng", "ƒê∆∞·ªùng", "Th√πng r√°c", "C√¥ng vi√™n"],
                    correct: 2
                },
                {
                    question: "üå≥ C√¢y c·ªëi gi√∫p g√¨ cho kh√¥ng kh√≠?",
                    options: ["L√†m b·∫©n", "L√†m s·∫°ch", "Kh√¥ng l√†m g√¨", "L√†m n√≥ng"],
                    correct: 1
                },
                {
                    question: "üíß Khi ƒë√°nh rƒÉng, con n√™n l√†m g√¨?",
                    options: ["M·ªü v√≤i ch·∫£y", "T·∫Øt v√≤i n∆∞·ªõc", "ƒê·ªÉ n∆∞·ªõc tr√†n", "Ch∆°i n∆∞·ªõc"],
                    correct: 1
                },
                {
                    question: "‚ôªÔ∏è Chai nh·ª±a c≈© n√™n l√†m g√¨?",
                    options: ["V·ª©t lung tung", "T√°i ch·∫ø", "ƒê·ªët", "Ch√¥n xu·ªëng ƒë·∫•t"],
                    correct: 1
                },
                {
                    question: "üåç ƒê·ªÉ b·∫£o v·ªá Tr√°i ƒê·∫•t, con n√™n?",
                    options: ["L√£ng ph√≠ ƒëi·ªán", "Ti·∫øt ki·ªám n∆∞·ªõc", "X·∫£ r√°c b·ª´a b√£i", "ƒê·ªën c√¢y"],
                    correct: 1
                }
            ],
            // 4. Th·ªÉ ch·∫•t - V·∫≠n ƒë·ªông
            physical: [
                {
                    question: "üèÉ Con ch·∫°y b·∫±ng g√¨?",
                    options: ["Tay", "Ch√¢n", "M·∫Øt", "Tai"],
                    correct: 1
                },
                {
                    question: "ü§∏ Nh·∫£y cao gi√∫p con kh·ªèe ph·∫ßn n√†o?",
                    options: ["Tay", "Ch√¢n", "ƒê·∫ßu", "B·ª•ng"],
                    correct: 1
                },
                {
                    question: "üö∂ ƒêi b·ªô m·ªói ng√†y gi√∫p con?",
                    options: ["·ªêm y·∫øu", "Kh·ªèe m·∫°nh", "M·ªát m·ªèi", "Bu·ªìn ng·ªß"],
                    correct: 1
                },
                {
                    question: "‚öΩ ƒê√° b√≥ng r√®n luy·ªán b·ªô ph·∫≠n n√†o?",
                    options: ["M·∫Øt", "Tai", "Ch√¢n", "Tay"],
                    correct: 2
                },
                {
                    question: "üßò T·∫≠p th·ªÉ d·ª•c bu·ªïi s√°ng gi√∫p con?",
                    options: ["U·ªÉ o·∫£i", "T·ªânh t√°o", "Bu·ªìn ng·ªß", "ƒêau ƒë·∫ßu"],
                    correct: 1
                }
            ],
            // 5. T√¨nh c·∫£m x√£ h·ªôi - C·∫£m x√∫c
            emotion: [
                {
                    question: "üòä Khi vui, con c·∫£m th·∫•y?",
                    options: ["Bu·ªìn", "H·∫°nh ph√∫c", "Gi·∫≠n d·ªØ", "S·ª£ h√£i"],
                    correct: 1
                },
                {
                    question: "üò¢ Khi b·∫°n kh√≥c, con n√™n?",
                    options: ["C∆∞·ªùi nh·∫°o", "An ·ªßi", "B·ªè ƒëi", "La m·∫Øng"],
                    correct: 1
                },
                {
                    question: "üò† Khi gi·∫≠n, con n√™n l√†m g√¨?",
                    options: ["ƒê√°nh ng∆∞·ªùi", "Th·ªü s√¢u b√¨nh tƒ©nh", "La h√©t", "N√©m ƒë·ªì"],
                    correct: 1
                },
                {
                    question: "ü§ó Khi th∆∞∆°ng ng∆∞·ªùi kh√°c, con?",
                    options: ["√çch k·ª∑", "Chia s·∫ª", "Tranh gi√†nh", "C∆∞·ªõp ƒë·ªì"],
                    correct: 1
                },
                {
                    question: "üò® Khi s·ª£ h√£i, con n√™n?",
                    options: ["Gi·∫•u ƒëi", "N√≥i v·ªõi ng∆∞·ªùi l·ªõn", "Kh√≥c th·∫ßm", "Ch·∫°y tr·ªën"],
                    correct: 1
                }
            ]
        };
        
        // Terrain icons
        const terrainIcons = {
            grass: 'üå∏',
            forest: 'üå≥',
            mountain: 'üèîÔ∏è',
            water: 'üíß',
            castle: 'üè∞',
            path: 'üõ§Ô∏è'
        };
        
        // Walkable terrains
        const walkableTerrain = ['grass', 'path', 'castle'];
        
        // Create sparkles
        function createSparkles() {
            const wrapper = document.getElementById('mapWrapper');
            const sparkleEmojis = ['‚ú®', '‚≠ê', 'üåü', 'üí´'];
            
            setInterval(() => {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                wrapper.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 3000);
            }, 1500);
        }
        
        function initMap() {
            const mapGrid = document.getElementById('mapGrid');
            mapGrid.innerHTML = '';
            
            for (let y = 0; y < 10; y++) {
                for (let x = 0; x < 12; x++) {
                    const tile = document.createElement('div');
                    tile.className = `tile ${mapData[y][x]}`;
                    tile.dataset.x = x;
                    tile.dataset.y = y;
                    
                    const icon = document.createElement('span');
                    icon.className = 'tile-icon';
                    icon.textContent = terrainIcons[mapData[y][x]];
                    tile.appendChild(icon);
                    
                    tile.onclick = () => handleTileClick(x, y);
                    
                    mapGrid.appendChild(tile);
                }
            }
            
            renderItems();
            updateCharacterPosition();
            highlightReachableTiles();
        }
        
        function renderItems() {
            // Render challenges (owls)
            mapItems.challenges.forEach(challenge => {
                if (!challenge.completed) {
                    const tile = document.querySelector(`[data-x="${challenge.x}"][data-y="${challenge.y}"]`);
                    if (tile) {
                        const icon = document.createElement('span');
                        icon.className = 'tile-icon';
                        icon.textContent = 'ü¶â';
                        icon.style.fontSize = 'clamp(20px, 5vw, 42px)';
                        icon.style.zIndex = '5';
                        tile.appendChild(icon);
                    }
                }
            });
            
            // Render treasures (with lock if locked)
            mapItems.treasures.forEach(treasure => {
                if (!treasure.collected) {
                    const tile = document.querySelector(`[data-x="${treasure.x}"][data-y="${treasure.y}"]`);
                    if (tile) {
                        const icon = document.createElement('span');
                        icon.className = 'tile-icon';
                        icon.textContent = treasure.locked ? 'üîí' : 'üéÅ';
                        icon.style.fontSize = 'clamp(20px, 5vw, 42px)';
                        icon.style.zIndex = '5';
                        icon.style.animation = 'bunnyHop 1s ease-in-out infinite';
                        tile.appendChild(icon);
                    }
                }
            });
            
            // Render carrots
            mapItems.carrots.forEach(carrot => {
                if (!carrot.collected) {
                    const tile = document.querySelector(`[data-x="${carrot.x}"][data-y="${carrot.y}"]`);
                    if (tile) {
                        const icon = document.createElement('span');
                        icon.className = 'tile-icon';
                        icon.textContent = 'ü•ï';
                        icon.style.fontSize = 'clamp(18px, 5vw, 38px)';
                        icon.style.zIndex = '5';
                        tile.appendChild(icon);
                    }
                }
            });
        }
        
        function handleTileClick(x, y) {
            const dx = Math.abs(x - characterPos.x);
            const dy = Math.abs(y - characterPos.y);
            
            if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
                if (walkableTerrain.includes(mapData[y][x])) {
                    attemptMove(x, y);
                } else {
                    showMessage('‚ùå Th·ªè kh√¥ng th·ªÉ ƒëi qua ƒë√¢y!');
                }
            } else if (dx === 0 && dy === 0) {
                showMessage('üìç Th·ªè ƒëang ·ªü ƒë√¢y!');
            } else {
                showMessage('‚ö†Ô∏è Ch·ªâ c√≥ th·ªÉ nh·∫£y 1 √¥!');
            }
        }
        
        function attemptMove(x, y) {
            // Check for challenge
            const challenge = mapItems.challenges.find(c => c.x === x && c.y === y && !c.completed);
            if (challenge) {
                currentChallenge = { type: challenge.type, target: challenge, nextX: x, nextY: y, isTreasure: false };
                showChallenge(challenge.type, false);
                return;
            }
            
            // Check for treasure (locked, needs challenge)
            const treasure = mapItems.treasures.find(t => t.x === x && t.y === y && !t.collected);
            if (treasure) {
                if (treasure.locked) {
                    // Show treasure challenge
                    const types = ['math', 'writing', 'environment', 'physical', 'emotion'];
                    const randomType = types[Math.floor(Math.random() * types.length)];
                    currentChallenge = { type: randomType, target: treasure, nextX: x, nextY: y, isTreasure: true };
                    showChallenge(randomType, true);
                    return;
                } else {
                    treasure.collected = true;
                    treasures++;
                    showItemCollected('üéÅ T√¨m ƒë∆∞·ª£c kho b√°u!');
                    
                    if (treasures >= 3) {
                        setTimeout(() => gameWon(), 1500);
                    }
                }
            }
            
            // Check for carrot
            const carrot = mapItems.carrots.find(c => c.x === x && c.y === y && !c.collected);
            if (carrot) {
                carrot.collected = true;
                carrots++;
                showItemCollected('ü•ï Nh·∫∑t ƒë∆∞·ª£c c√† r·ªët!');
            }
            
            // Normal move
            characterPos.x = x;
            characterPos.y = y;
            moveCount++;
            initMap();
            updateStats();
        }
        
        function showChallenge(type, isTreasure) {
            const modal = document.getElementById('challengeModal');
            const challengeList = challenges[type];
            const challenge = challengeList[Math.floor(Math.random() * challengeList.length)];
            
            if (isTreasure) {
                document.getElementById('challengeIcon').textContent = 'üéÅ';
                document.getElementById('challengeTitle').textContent = 'üîí M·ªü kh√≥a kho b√°u!';
            } else {
                document.getElementById('challengeIcon').textContent = 'ü¶â';
                document.getElementById('challengeTitle').textContent = 'C√¥ C√∫ M√®o h·ªèi b√†i!';
            }
            
            document.getElementById('challengeQuestion').textContent = challenge.question;
            document.getElementById('challengeFeedback').textContent = '';
            
            const optionsContainer = document.getElementById('challengeOptions');
            optionsContainer.innerHTML = '';
            
            challenge.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'challenge-option';
                btn.textContent = option;
                btn.onclick = () => handleChallengeAnswer(index, challenge.correct);
                optionsContainer.appendChild(btn);
            });
            
            modal.classList.add('active');
        }
        
        function handleChallengeAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.challenge-option');
            const feedback = document.getElementById('challengeFeedback');
            const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
            const encouragement = config.encouragement_text || defaultConfig.encouragement_text;
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                buttons[selected].classList.add('correct');
                feedback.textContent = `‚úÖ ${encouragement}`;
                feedback.style.color = '#32CD32';
                
                setTimeout(() => {
                    closeChallenge(true);
                }, 1500);
            } else {
                buttons[selected].classList.add('wrong');
                feedback.textContent = '‚ùå Ch∆∞a ƒë√∫ng! Th·ª≠ l·∫°i nha! üíñ';
                feedback.style.color = '#FF6347';
                
                health--;
                updateStats();
                
                setTimeout(() => {
                    if (health <= 0) {
                        closeChallenge(false);
                        gameOver();
                    } else {
                        closeChallenge(false);
                    }
                }, 1500);
            }
        }
        
        function closeChallenge(success) {
            const modal = document.getElementById('challengeModal');
            modal.classList.remove('active');
            
            if (success && currentChallenge) {
                if (currentChallenge.isTreasure) {
                    // Unlock and collect treasure
                    currentChallenge.target.locked = false;
                    currentChallenge.target.collected = true;
                    treasures++;
                    characterPos.x = currentChallenge.nextX;
                    characterPos.y = currentChallenge.nextY;
                    moveCount++;
                    showItemCollected('üéÅ M·ªü kh√≥a kho b√°u th√†nh c√¥ng!');
                    
                    if (treasures >= 3) {
                        setTimeout(() => gameWon(), 1500);
                    }
                } else {
                    // Complete regular challenge
                    currentChallenge.target.completed = true;
                    characterPos.x = currentChallenge.nextX;
                    characterPos.y = currentChallenge.nextY;
                    moveCount++;
                    showItemCollected('üåü V∆∞·ª£t qua th·ª≠ th√°ch!');
                }
                initMap();
            }
            
            updateStats();
            currentChallenge = null;
        }
        
        function showItemCollected(text) {
            const msg = document.createElement('div');
            msg.className = 'item-collected';
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        }
        
        function gameOver() {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #FFB6C1 0%, #FFA07A 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 4000;
                color: white;
            `;
            msg.innerHTML = `
                <div style="font-size: 100px; margin-bottom: 20px;">üò¢</div>
                <h1 style="font-size: 48px; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">√îi kh√¥ng!</h1>
                <p style="font-size: 28px; margin-bottom: 30px;">Th·ªè con ƒë√£ h·∫øt tim r·ªìi! üíî</p>
                <button onclick="location.reload()" style="padding: 20px 50px; font-size: 24px; background: white; color: #FF69B4; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">üîÑ Ch∆°i l·∫°i n√†o!</button>
            `;
            document.body.appendChild(msg);
        }
        
        function gameWon() {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF69B4 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 4000;
                color: white;
            `;
            msg.innerHTML = `
                <div style="font-size: 120px; margin-bottom: 20px; animation: iconSpin 2s linear infinite;">üèÜ</div>
                <h1 style="font-size: 56px; margin-bottom: 20px; text-shadow: 4px 4px 8px rgba(0,0,0,0.3);">üéâ Chi·∫øn th·∫Øng! üéâ</h1>
                <p style="font-size: 32px; margin-bottom: 15px;">Th·ªè con ƒë√£ t√¨m ƒë∆∞·ª£c c·∫£ 3 kho b√°u!</p>
                <p style="font-size: 24px; margin-bottom: 30px;">ü•ï ${carrots} c√† r·ªët | üë£ ${moveCount} b∆∞·ªõc | üíñ ${health}/3 tim</p>
                <button onclick="location.reload()" style="padding: 20px 50px; font-size: 24px; background: white; color: #FF69B4; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 8px 20px rgba(0,0,0,0.3);">üîÑ Ch∆°i l·∫°i n√†o!</button>
            `;
            document.body.appendChild(msg);
        }
        
        function moveCharacter(direction) {
            let newX = characterPos.x;
            let newY = characterPos.y;
            
            switch(direction) {
                case 'up':
                    newY--;
                    break;
                case 'down':
                    newY++;
                    break;
                case 'left':
                    newX--;
                    break;
                case 'right':
                    newX++;
                    break;
            }
            
            if (newX < 0 || newX >= 12 || newY < 0 || newY >= 10) {
                showMessage('üö´ Ra ngo√†i b·∫£n ƒë·ªì r·ªìi!');
                return;
            }
            
            if (walkableTerrain.includes(mapData[newY][newX])) {
                attemptMove(newX, newY);
            } else {
                showMessage('‚ùå Th·ªè kh√¥ng th·ªÉ ƒëi qua ƒë√¢y!');
            }
        }
        
        function updateCharacterPosition() {
            document.querySelectorAll('.tile').forEach(tile => {
                const sprite = tile.querySelector('.character-sprite');
                if (sprite) {
                    sprite.remove();
                }
                tile.classList.remove('character');
            });
            
            const currentTile = document.querySelector(`[data-x="${characterPos.x}"][data-y="${characterPos.y}"]`);
            if (currentTile) {
                const sprite = document.createElement('div');
                sprite.className = 'character-sprite';
                sprite.textContent = 'üê∞';
                currentTile.appendChild(sprite);
                currentTile.classList.add('character');
            }
        }
        
        function highlightReachableTiles() {
            document.querySelectorAll('.tile').forEach(tile => {
                tile.classList.remove('selectable');
            });
            
            const directions = [
                { dx: 0, dy: -1 },
                { dx: 0, dy: 1 },
                { dx: -1, dy: 0 },
                { dx: 1, dy: 0 }
            ];
            
            directions.forEach(dir => {
                const x = characterPos.x + dir.dx;
                const y = characterPos.y + dir.dy;
                
                if (x >= 0 && x < 12 && y >= 0 && y < 10) {
                    if (walkableTerrain.includes(mapData[y][x])) {
                        const tile = document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
                        if (tile) {
                            tile.classList.add('selectable');
                        }
                    }
                }
            });
        }
        
        function updateStats() {
            document.getElementById('healthDisplay').textContent = `${health}/3`;
            document.getElementById('treasureCount').textContent = treasures;
            document.getElementById('carrotCount').textContent = carrots;
            document.getElementById('moveCount').textContent = moveCount;
        }
        
        function showMessage(text) {
            const msg = document.createElement('div');
            msg.textContent = text;
            msg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #FF69B4, #FFB6C1);
                color: white;
                padding: 25px 45px;
                border-radius: 20px;
                font-size: 24px;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 8px 25px rgba(255,105,180,0.5);
                border: 4px solid white;
            `;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    e.preventDefault();
                    moveCharacter('up');
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    e.preventDefault();
                    moveCharacter('down');
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    e.preventDefault();
                    moveCharacter('left');
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    e.preventDefault();
                    moveCharacter('right');
                    break;
            }
        });
        
        // Initialize game
        initMap();
        createSparkles();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99fb23fd52226042',t:'MTc2MzMzOTY0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>